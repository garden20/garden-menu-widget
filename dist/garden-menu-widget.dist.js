/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.0.6 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

//     Underscore.js 1.3.3
//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore is freely distributable under the MIT license.
//     Portions of Underscore are inspired or borrowed from Prototype,
//     Oliver Steele's Functional, and John Resig's Micro-Templating.
//     For all details and documentation:
//     http://documentcloud.github.com/underscore

/*!
Math.uuid.js (v1.4)
http://www.broofa.com
mailto:robert@broofa.com

Copyright (c) 2010 Robert Kieffer
Dual licensed under the MIT and GPL licenses.
*/

/*
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.1 Copyright (C) Paul Johnston 1999 - 2002.
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */

// parseUri 1.2.2
// (c) Steven Levithan <stevenlevithan.com>
// MIT License

/*!
 * Modernizr v2.6.2
 * www.modernizr.com
 *
 * Copyright (c) Faruk Ates, Paul Irish, Alex Sexton
 * Available under the BSD and MIT licenses: www.modernizr.com/license/
 */

/*! HTML5 Shiv v3.6.1 | @afarkas @jdalton @jon_neal @rem | MIT/GPL2 Licensed */

/* svg.js v0.5-5-g7a2188b - svg element container fx event group arrange defs mask pattern gradient doc shape wrap rect ellipse line poly path image text nested sugar - svgjs.com/license */

var requirejs,require,define;(function(global){function isFunction(e){return ostring.call(e)==="[object Function]"}function isArray(e){return ostring.call(e)==="[object Array]"}function each(e,t){if(e){var n;for(n=0;n<e.length;n+=1)if(e[n]&&t(e[n],n,e))break}}function eachReverse(e,t){if(e){var n;for(n=e.length-1;n>-1;n-=1)if(e[n]&&t(e[n],n,e))break}}function hasProp(e,t){return hasOwn.call(e,t)}function eachProp(e,t){var n;for(n in e)if(e.hasOwnProperty(n)&&t(e[n],n))break}function mixin(e,t,n,r){return t&&eachProp(t,function(t,i){if(n||!hasProp(e,i))r&&typeof t!="string"?(e[i]||(e[i]={}),mixin(e[i],t,n,r)):e[i]=t}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeContextModuleFunc(e,t,n){return function(){var r=aps.call(arguments,0),i;return n&&isFunction(i=r[r.length-1])&&(i.__requireJsBuild=!0),r.push(t),e.apply(null,r)}}function addRequireMethods(e,t,n){each([["toUrl"],["undef"],["defined","requireDefined"],["specified","requireSpecified"]],function(r){var i=r[1]||r[0];e[r[0]]=t?makeContextModuleFunc(t[i],n):function(){var e=contexts[defContextName];return e[i].apply(e,arguments)}})}function makeError(e,t,n,r){var i=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return i.requireType=e,i.requireModules=r,n&&(i.originalError=n),i}function newContext(e){function v(e){var t,n;for(t=0;e[t];t+=1){n=e[t];if(n===".")e.splice(t,1),t-=1;else if(n===".."){if(t===1&&(e[2]===".."||e[0]===".."))break;t>0&&(e.splice(t-1,2),t-=2)}}}function m(e,t,n){var r,i,s,u,a,f,l,c,h,p,d,m=t&&t.split("/"),g=m,y=o.map,b=y&&y["*"];e&&e.charAt(0)==="."&&(t?(o.pkgs[t]?g=m=[t]:g=m.slice(0,m.length-1),e=g.concat(e.split("/")),v(e),i=o.pkgs[r=e[0]],e=e.join("/"),i&&e===r+"/"+i.main&&(e=r)):e.indexOf("./")===0&&(e=e.substring(2)));if(n&&(m||b)&&y){u=e.split("/");for(a=u.length;a>0;a-=1){l=u.slice(0,a).join("/");if(m)for(f=m.length;f>0;f-=1){s=y[m.slice(0,f).join("/")];if(s){s=s[l];if(s){c=s,h=a;break}}}if(c)break;!p&&b&&b[l]&&(p=b[l],d=a)}!c&&p&&(c=p,h=d),c&&(u.splice(0,h,c),e=u.join("/"))}return e}function g(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===r.contextName)return t.parentNode.removeChild(t),!0})}function y(e){var t=o.paths[e];if(t&&isArray(t)&&t.length>1)return g(e),t.shift(),r.undef(e),r.require([e]),!0}function b(e,t,n,i){var s,o,u,a=e?e.indexOf("!"):-1,f=null,c=t?t.name:null,d=e,v=!0,g="";return e||(v=!1,e="_@r"+(h+=1)),a!==-1&&(f=e.substring(0,a),e=e.substring(a+1,e.length)),f&&(f=m(f,c,i),o=l[f]),e&&(f?o&&o.normalize?g=o.normalize(e,function(e){return m(e,c,i)}):g=m(e,c,i):(g=m(e,c,i),s=r.nameToUrl(g))),u=f&&!o&&!n?"_unnormalized"+(p+=1):"",{prefix:f,name:g,parentMap:t,unnormalized:!!u,url:s,originalName:d,isDefine:v,id:(f?f+"!"+g:g)+u}}function w(e){var t=e.id,n=u[t];return n||(n=u[t]=new r.Module(e)),n}function E(e,t,n){var r=e.id,i=u[r];hasProp(l,r)&&(!i||i.defineEmitComplete)?t==="defined"&&n(l[r]):w(e).on(t,n)}function S(e,t){var n=e.requireModules,r=!1;t?t(e):(each(n,function(t){var n=u[t];n&&(n.error=e,n.events.error&&(r=!0,n.emit("error",e)))}),r||req.onError(e))}function x(){globalDefQueue.length&&(apsp.apply(f,[f.length-1,0].concat(globalDefQueue)),globalDefQueue=[])}function T(e,t,n){var i=e&&e.map,s=makeContextModuleFunc(n||r.require,i,t);return addRequireMethods(s,r,i),s.isBrowser=isBrowser,s}function N(e){delete u[e],each(d,function(t,n){if(t.map.id===e)return d.splice(n,1),t.defined||(r.waitCount-=1),!0})}function C(e,t,n){var r=e.map.id,i=e.depMaps,s;if(!e.inited)return;return t[r]?e:(t[r]=!0,each(i,function(e){var r=e.id,i=u[r];if(!i||n[r]||!i.inited||!i.enabled)return;return s=C(i,t,n)}),n[r]=!0,s)}function k(e,t,n){var r=e.map.id,s=e.depMaps;if(!e.inited||!e.map.isDefine)return;return t[r]?l[r]:(t[r]=e,each(s,function(s){var o=s.id,a=u[o],f;if(i[o])return;if(a){if(!a.inited||!a.enabled){n[r]=!0;return}f=k(a,t,n),n[o]||e.defineDepById(o,f)}}),e.check(!0),l[r])}function L(e){e.check()}function A(){var e,n,i,a,f=o.waitSeconds*1e3,l=f&&r.startTime+f<(new Date).getTime(),c=[],h=!1,p=!0;if(t)return;t=!0,eachProp(u,function(t){e=t.map,n=e.id;if(!t.enabled)return;if(!t.error)if(!t.inited&&l)y(n)?(a=!0,h=!0):(c.push(n),g(n));else if(!t.inited&&t.fetched&&e.isDefine){h=!0;if(!e.prefix)return p=!1}});if(l&&c.length)return i=makeError("timeout","Load timeout for modules: "+c,null,c),i.contextName=r.contextName,S(i);p&&(each(d,function(e){if(e.defined)return;var t=C(e,{},{}),n={};t&&(k(t,n,{}),eachProp(n,L))}),eachProp(u,L)),(!l||a)&&h&&(isBrowser||isWebWorker)&&!s&&(s=setTimeout(function(){s=0,A()},50)),t=!1}function O(e){w(b(e[0],null,!0)).init(e[1],e[2])}function M(e,t,n,r){e.detachEvent&&!isOpera?r&&e.detachEvent(r,t):e.removeEventListener(n,t,!1)}function _(e){var t=e.currentTarget||e.srcElement;return M(t,r.onScriptLoad,"load","onreadystatechange"),M(t,r.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}var t,n,r,i,s,o={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{}},u={},a={},f=[],l={},c={},h=1,p=1,d=[];return i={require:function(e){return T(e)},exports:function(e){e.usingExports=!0;if(e.map.isDefine)return e.exports=l[e.map.id]={}},module:function(e){return e.module={id:e.map.id,uri:e.map.url,config:function(){return o.config&&o.config[e.map.id]||{}},exports:l[e.map.id]}}},n=function(e){this.events=a[e.id]||{},this.map=e,this.shim=o.shim[e.id],this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},n.prototype={init:function(e,t,n,r){r=r||{};if(this.inited)return;this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.depMaps.rjsSkipMap=e.rjsSkipMap,this.errback=n,this.inited=!0,this.ignore=r.ignore,r.enabled||this.enabled?this.enable():this.check()},defineDepById:function(e,t){var n;return each(this.depMaps,function(t,r){if(t.id===e)return n=r,!0}),this.defineDep(n,t)},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(this.fetched)return;this.fetched=!0,r.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();T(this,!0)(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()}))},load:function(){var e=this.map.url;c[e]||(c[e]=!0,r.load(this.map.id,e))},check:function(e){if(!this.enabled||this.enabling)return;var t,n,i=this.map.id,s=this.depExports,o=this.exports,a=this.factory;if(!this.inited)this.fetch();else if(this.error)this.emit("error",this.error);else if(!this.defining){this.defining=!0;if(this.depCount<1&&!this.defined){if(isFunction(a)){if(this.events.error)try{o=r.execCb(i,a,s,o)}catch(f){t=f}else o=r.execCb(i,a,s,o);this.map.isDefine&&(n=this.module,n&&n.exports!==undefined&&n.exports!==this.exports?o=n.exports:o===undefined&&this.usingExports&&(o=this.exports));if(t)return t.requireMap=this.map,t.requireModules=[this.map.id],t.requireType="define",S(this.error=t)}else o=a;this.exports=o,this.map.isDefine&&!this.ignore&&(l[i]=o,req.onResourceLoad&&req.onResourceLoad(r,this.map,this.depMaps)),delete u[i],this.defined=!0,r.waitCount-=1,r.waitCount===0&&(d=[])}this.defining=!1,e||this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}},callPlugin:function(){var e=this.map,t=e.id,n=b(e.prefix,null,!1,!0);E(n,"defined",bind(this,function(n){var i,s,a,f=this.map.name,l=this.map.parentMap?this.map.parentMap.name:null;if(this.map.unnormalized){n.normalize&&(f=n.normalize(f,function(e){return m(e,l,!0)})||""),s=b(e.prefix+"!"+f,this.map.parentMap,!1,!0),E(s,"defined",bind(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),a=u[s.id],a&&(this.events.error&&a.on("error",bind(this,function(e){this.emit("error",e)})),a.enable());return}i=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),i.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(u,function(e){e.map.id.indexOf(t+"_unnormalized")===0&&N(e.map.id)}),S(e)}),i.fromText=function(e,t){var n=useInteractive;n&&(useInteractive=!1),w(b(e)),req.exec(t),n&&(useInteractive=!0),r.completeLoad(e)},n.load(e.name,T(e.parentMap,!0,function(e,t,n){return e.rjsSkipMap=!0,r.require(e,t,n)}),i,o)})),r.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){this.enabled=!0,this.waitPushed||(d.push(this),r.waitCount+=1,this.waitPushed=!0),this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var n,s,o;if(typeof e=="string"){e=b(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.depMaps.rjsSkipMap),this.depMaps[t]=e,o=i[e.id];if(o){this.depExports[t]=o(this);return}this.depCount+=1,E(e,"defined",bind(this,function(e){this.defineDep(t,e),this.check()})),this.errback&&E(e,"error",this.errback)}n=e.id,s=u[n],!i[n]&&s&&!s.enabled&&r.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=u[e.id];t&&!t.enabled&&r.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),e==="error"&&delete this.events[e]}},r={config:o,contextName:e,registry:u,defined:l,urlFetched:c,waitCount:0,defQueue:f,Module:n,makeModuleMap:b,configure:function(e){e.baseUrl&&e.baseUrl.charAt(e.baseUrl.length-1)!=="/"&&(e.baseUrl+="/");var t=o.pkgs,n=o.shim,i=o.paths,s=o.map;mixin(o,e,!0),o.paths=mixin(i,e.paths,!0),e.map&&(o.map=mixin(s||{},e.map,!0,!0)),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),e.exports&&!e.exports.__buildReady&&(e.exports=r.makeShimExports(e.exports)),n[t]=e}),o.shim=n),e.packages&&(each(e.packages,function(e){var n;e=typeof e=="string"?{name:e}:e,n=e.location,t[e.name]={name:e.name,location:n||e.name,main:(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}}),o.pkgs=t),eachProp(u,function(e,t){!e.inited&&!e.map.unnormalized&&(e.map=b(t))}),(e.deps||e.callback)&&r.require(e.deps||[],e.callback)},makeShimExports:function(e){var t;return typeof e=="string"?(t=function(){return getGlobal(e)},t.exports=e,t):function(){return e.apply(global,arguments)}},requireDefined:function(e,t){return hasProp(l,b(e,t,!1,!0).id)},requireSpecified:function(e,t){return e=b(e,t,!1,!0).id,hasProp(l,e)||hasProp(u,e)},require:function(t,n,i,s){var o,u,a,c,h;if(typeof t=="string")return isFunction(n)?S(makeError("requireargs","Invalid require call"),i):req.get?req.get(r,t,n):(o=t,s=n,a=b(o,s,!1,!0),u=a.id,hasProp(l,u)?l[u]:S(makeError("notloaded",'Module name "'+u+'" has not been loaded yet for context: '+e)));i&&!isFunction(i)&&(s=i,i=undefined),n&&!isFunction(n)&&(s=n,n=undefined),x();while(f.length){h=f.shift();if(h[0]===null)return S(makeError("mismatch","Mismatched anonymous define() module: "+h[h.length-1]));O(h)}return c=w(b(null,s)),c.init(t,n,i,{enabled:!0}),A(),r.require},undef:function(e){x();var t=b(e,null,!0),n=u[e];delete l[e],delete c[t.url],delete a[e],n&&(n.events.defined&&(a[e]=n.events),N(e))},enable:function(e,t){var n=u[e.id];n&&w(e).enable()},completeLoad:function(e){var t,n,r,i=o.shim[e]||{},s=i.exports&&i.exports.exports;x();while(f.length){n=f.shift();if(n[0]===null){n[0]=e;if(t)break;t=!0}else n[0]===e&&(t=!0);O(n)}r=u[e];if(!t&&!l[e]&&r&&!r.inited){if(o.enforceDefine&&(!s||!getGlobal(s))){if(y(e))return;return S(makeError("nodefine","No define call for "+e,null,[e]))}O([e,i.deps||[],i.exports])}A()},toUrl:function(e,t){var n=e.lastIndexOf("."),i=null;return n!==-1&&(i=e.substring(n,e.length),e=e.substring(0,n)),r.nameToUrl(m(e,t&&t.id,!0),i)},nameToUrl:function(e,t){var n,r,i,s,u,a,f,l,c;if(req.jsExtRegExp.test(e))l=e+(t||"");else{n=o.paths,r=o.pkgs,u=e.split("/");for(a=u.length;a>0;a-=1){f=u.slice(0,a).join("/"),i=r[f],c=n[f];if(c){isArray(c)&&(c=c[0]),u.splice(0,a,c);break}if(i){e===i.name?s=i.location+"/"+i.main:s=i.location,u.splice(0,a,s);break}}l=u.join("/"),l+=t||(/\?/.test(l)?"":".js"),l=(l.charAt(0)==="/"||l.match(/^[\w\+\.\-]+:/)?"":o.baseUrl)+l}return o.urlArgs?l+((l.indexOf("?")===-1?"?":"&")+o.urlArgs):l},load:function(e,t){req.load(r,e,t)},execCb:function(e,t,n,r){return t.apply(r,n)},onScriptLoad:function(e){if(e.type==="load"||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=_(e);r.completeLoad(t.id)}},onScriptError:function(e){var t=_(e);if(!y(t.id))return S(makeError("scripterror","Script error",e,[t.id]))}}}function getInteractiveScript(){return interactiveScript&&interactiveScript.readyState==="interactive"?interactiveScript:(eachReverse(scripts(),function(e){if(e.readyState==="interactive")return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.0.6",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,aps=ap.slice,apsp=ap.splice,isBrowser=typeof window!="undefined"&&!!navigator&&!!document,isWebWorker=!isBrowser&&typeof importScripts!="undefined",readyRegExp=isBrowser&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera=typeof opera!="undefined"&&opera.toString()==="[object Opera]",contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(typeof define!="undefined")return;if(typeof requirejs!="undefined"){if(isFunction(requirejs))return;cfg=requirejs,requirejs=undefined}typeof require!="undefined"&&!isFunction(require)&&(cfg=require,require=undefined),req=requirejs=function(e,t,n,r){var i,s,o=defContextName;return!isArray(e)&&typeof e!="string"&&(s=e,isArray(t)?(e=t,t=n,n=r):e=[]),s&&s.context&&(o=s.context),i=contexts[o],i||(i=contexts[o]=req.s.newContext(o)),s&&i.configure(s),i.require(e,t,n)},req.config=function(e){return req(e)},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),addRequireMethods(req),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=function(e){throw e},req.load=function(e,t,n){var r=e&&e.config||{},i;if(isBrowser)return i=r.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),i.type=r.scriptType||"text/javascript",i.charset="utf-8",i.async=!0,i.setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),i.attachEvent&&!(i.attachEvent.toString&&i.attachEvent.toString().indexOf("[native code")<0)&&!isOpera?(useInteractive=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)):(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)),i.src=n,currentlyAddingScript=i,baseElement?head.insertBefore(i,baseElement):head.appendChild(i),currentlyAddingScript=null,i;isWebWorker&&(importScripts(n),e.completeLoad(t))},isBrowser&&eachReverse(scripts(),function(e){head||(head=e.parentNode),dataMain=e.getAttribute("data-main");if(dataMain)return cfg.baseUrl||(src=dataMain.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath,dataMain=mainScript),dataMain=dataMain.replace(jsSuffixRegExp,""),cfg.deps=cfg.deps?cfg.deps.concat(dataMain):[dataMain],!0}),define=function(e,t,n){var r,i;typeof e!="string"&&(n=t,t=e,e=null),isArray(t)||(n=t,t=[]),!t.length&&isFunction(n)&&n.length&&(n.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(n.length===1?["require"]:["require","exports","module"]).concat(t)),useInteractive&&(r=currentlyAddingScript||getInteractiveScript(),r&&(e||(e=r.getAttribute("data-requiremodule")),i=contexts[r.getAttribute("data-requirecontext")])),(i?i.defQueue:globalDefQueue).push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)})(this),define("requireLib",function(){});var jam={packages:[{name:"async",location:"jam/async",main:"./lib/async"},{name:"bowser",location:"jam/bowser",main:"./bowser.js"},{name:"garden-dashboard-core",location:"jam/garden-dashboard-core",main:"garden-dashboard-core.js"},{name:"garden-default-settings",location:"jam/garden-default-settings",main:"garden-default-settings.js"},{name:"garden-menu",location:"jam/garden-menu",main:"garden-menu.js"},{name:"garden-views",location:"jam/garden-views",main:"garden-views.js"},{name:"jquery",location:"jam/jquery",main:"jquery-1.9.1.min.js"},{name:"jscss",location:"jam/jscss",main:"lib/index.js"},{name:"md5",location:"jam/md5",main:"md5.js"},{name:"modernizer",location:"jam/modernizer",main:"modernizr-development.js"},{name:"pouchdb",location:"jam/pouchdb",main:"dist/pouchdb.amd-nightly.js"},{name:"querystring",location:"jam/querystring",main:"querystring.js"},{name:"simple-uuid",location:"jam/simple-uuid",main:"uuid.js"},{name:"stately",location:"jam/stately",main:"Stately.js"},{name:"svg",location:"jam/svg",main:"dist/svg.js"},{name:"sync-status-icon",location:"jam/sync-status-icon",main:"sync-status-icon.js"},{name:"underscore",location:"jam/underscore",main:"underscore.js"},{name:"url",location:"jam/url",main:"url.js"}],version:"0.2.11",shim:{}};if(typeof require!="undefined"&&require.config)require.config({packages:jam.packages,shim:jam.shim});else var require={packages:jam.packages,shim:jam.shim};typeof exports!="undefined"&&typeof module!="undefined"&&(module.exports=jam),define("jam/require.config",function(){}),function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd?define("url/url",[],t):e.url=t()}(this,function(e,t,n,r){function x(e,t,n){if(e&&typeof e=="object"&&e.href)return e;if(typeof e!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r={},s=e;for(var u=0,l=s.length;u<l;u++)if(a(c,s.charAt(u))===-1)break;u!==0&&(s=s.substr(u));var h=f.exec(s);if(h){h=h[0];var E=h.toLowerCase();r.protocol=E,s=s.substr(h.length)}if(n||h||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var x=s.substr(0,2)==="//";x&&(!h||!w[h])&&(s=s.substr(2),r.slashes=!0)}if(!w[h]&&(x||h&&!S[h])){var N=s.indexOf("@");if(N!==-1){var C=!0;for(var u=0,l=v.length;u<l;u++){var L=s.indexOf(v[u]);if(L!==-1&&L<N){C=!1;break}}C&&(r.auth=s.substr(0,N),s=s.substr(N+1))}var A=-1;for(var u=0,l=d.length;u<l;u++){var L=s.indexOf(d[u]);L!==-1&&(A<0||L<A)&&(A=L)}A!==-1?(r.host=s.substr(0,A),s=s.substr(A)):(r.host=s,s="");var O=k(r.host),M=o(O);for(var u=0,l=M.length;u<l;u++){var _=M[u];r[_]=O[_]}r.hostname=r.hostname||"";if(r.hostname.length>m)r.hostname="";else{var D=r.hostname.split(/\./);for(var u=0,l=D.length;u<l;u++){var P=D[u];if(!P)continue;if(!P.match(g)){var H="";for(var B=0,j=P.length;B<j;B++)P.charCodeAt(B)>127?H+="x":H+=P[B];if(!H.match(g)){var F=D.slice(0,u),I=D.slice(u+1),q=P.match(y);q&&(F.push(q[1]),I.unshift(q[2])),I.length&&(s="/"+I.join(".")+s),r.hostname=F.join(".");break}}}}r.hostname=r.hostname.toLowerCase(),r.host=(r.hostname||"")+(r.port?":"+r.port:""),r.href+=r.host}if(!b[E]){for(var u=0,l=p.length;u<l;u++){var R=p[u],U=encodeURIComponent(R);U===R&&(U=escape(R)),s=s.split(R).join(U)}var z=s.length;for(var u=0,l=c.length;u<l;u++){var W=s.indexOf(c[u]);W!==-1&&(z=Math.min(W,z))}s=s.substr(0,z)}var X=s.indexOf("#");X!==-1&&(r.hash=s.substr(X),s=s.slice(0,X));var V=s.indexOf("?");V!==-1?(r.search=s.substr(V),r.query=s.substr(V+1),t&&(r.query=i.parse(r.query)),s=s.slice(0,V)):t&&(r.search="",r.query={}),s&&(r.pathname=s),S[h]&&r.hostname&&!r.pathname&&(r.pathname="/");if(r.pathname||r.search)r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"");return r.href=T(r),r}function T(e){typeof e=="string"&&(e=x(e));var t=e.auth||"";if(t){t=t.split("@").join("%40");for(var n=0,r=v.length;n<r;n++){var s=v[n];t=t.split(s).join(encodeURIComponent(s))}t+="@"}var u=e.protocol||"",a=e.host!==undefined?t+e.host:e.hostname!==undefined?t+e.hostname+(e.port?":"+e.port:""):!1,f=e.pathname||"",l=e.query&&(typeof e.query=="object"&&o(e.query).length?i.stringify(e.query):"")||"",c=e.search||l&&"?"+l||"",h=e.hash||"";return u&&u.substr(u.length-1)!==":"&&(u+=":"),e.slashes||(!u||S[u])&&a!==!1?(a="//"+(a||""),f&&f.charAt(0)!=="/"&&(f="/"+f)):a||(a=""),h&&h.charAt(0)!=="#"&&(h="#"+h),c&&c.charAt(0)!=="?"&&(c="?"+c),u+a+f+c+h}function N(e,t){return T(C(e,t))}function C(e,t){if(!e)return t;e=x(T(e),!1,!0),t=x(T(t),!1,!0),e.hash=t.hash;if(t.href==="")return e.href=T(e),e;if(t.slashes&&!t.protocol)return t.protocol=e.protocol,S[t.protocol]&&t.hostname&&!t.pathname&&(t.path=t.pathname="/"),t.href=T(t),t;if(t.protocol&&t.protocol!==e.protocol){if(!S[t.protocol])return t.href=T(t),t;e.protocol=t.protocol;if(!t.host&&!w[t.protocol]){var n=(t.pathname||"").split("/");while(n.length&&!(t.host=n.shift()));t.host||(t.host=""),t.hostname||(t.hostname=""),n[0]!==""&&n.unshift(""),n.length<2&&n.unshift(""),t.pathname=n.join("/")}e.pathname=t.pathname,e.search=t.search,e.query=t.query,e.host=t.host||"",e.auth=t.auth,e.hostname=t.hostname||t.host,e.port=t.port;if(e.pathname!==undefined||e.search!==undefined)e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"");return e.slashes=e.slashes||t.slashes,e.href=T(e),e}var r=e.pathname&&e.pathname.charAt(0)==="/",i=t.host!==undefined||t.pathname&&t.pathname.charAt(0)==="/",s=i||r||e.host&&t.pathname,o=s,u=e.pathname&&e.pathname.split("/")||[],n=t.pathname&&t.pathname.split("/")||[],a=e.protocol&&!S[e.protocol];a&&(delete e.hostname,delete e.port,e.host&&(u[0]===""?u[0]=e.host:u.unshift(e.host)),delete e.host,t.protocol&&(delete t.hostname,delete t.port,t.host&&(n[0]===""?n[0]=t.host:n.unshift(t.host)),delete t.host),s=s&&(n[0]===""||u[0]===""));if(i)e.host=t.host||t.host===""?t.host:e.host,e.hostname=t.hostname||t.hostname===""?t.hostname:e.hostname,e.search=t.search,e.query=t.query,u=n;else if(n.length)u||(u=[]),u.pop(),u=u.concat(n),e.search=t.search,e.query=t.query;else if("search"in t){if(a){e.hostname=e.host=u.shift();var f=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;f&&(e.auth=f.shift(),e.host=e.hostname=f.shift())}e.search=t.search,e.query=t.query;if(e.pathname!==undefined||e.search!==undefined)e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"");return e.href=T(e),e}if(!u.length)return delete e.pathname,e.search?delete e.path:e.path="/"+e.search,e.href=T(e),e;var l=u.slice(u.length-1)[0],c=(e.host||t.host)&&(l==="."||l==="..")||l==="",h=0;for(var p=u.length;p>=0;p--)l=u[p],l=="."?u.splice(p,1):l===".."?(u.splice(p,1),h++):h&&(u.splice(p,1),h--);if(!s&&!o)for(;h--;h)u.unshift("..");s&&u[0]!==""&&(!u[0]||u[0].charAt(0)!=="/")&&u.unshift(""),c&&u.join("/").substr(u.join("/").length-1)!=="/"&&u.push("");var d=u[0]===""||u[0]&&u[0].charAt(0)==="/";if(a){e.hostname=e.host=d?"":u.length?u.shift():"";var f=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;f&&(e.auth=f.shift(),e.host=e.hostname=f.shift())}s=s||e.host&&u.length,s&&!d&&u.unshift(""),e.pathname=u.join("/");if(e.pathname!==undefined||e.search!==undefined)e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"");return e.auth=t.auth||e.auth,e.slashes=e.slashes||t.slashes,e.href=T(e),e}function k(e){var t={},n=l.exec(e);return n&&(n=n[0],t.port=n.substr(1),e=e.substr(0,e.length-n.length)),e&&(t.hostname=e),t}var i={},s={},o=Object.keys||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},u=Array.prototype.indexOf,a=function(e,t){if(e==null)return-1;var n,r;if(u&&e.indexOf===u)return e.indexOf(t);for(n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1};s.parse=x,s.resolve=N,s.resolveObject=C,s.format=T;var f=/^([a-z0-9.+-]+:)/i,l=/:[0-9]+$/,c=["<",">",'"',"`"," ","\r","\n","	"],h=["{","}","|","\\","^","~","[","]","`"].concat(c),p=["'"],d=["%","/","?",";","#"].concat(h).concat(p),v=["/","@","?","#"].concat(c),m=255,g=/^[a-zA-Z0-9][a-z0-9A-Z_-]{0,62}$/,y=/^([a-zA-Z0-9][a-z0-9A-Z_-]{0,62})(.*)$/,b={javascript:!0,"javascript:":!0},w={javascript:!0,"javascript:":!0},E={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},S={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};return s}),define("url",["url/url"],function(e){return e}),function(){function C(e,t,n){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e._chain&&(e=e._wrapped),t._chain&&(t=t._wrapped);if(e.isEqual&&S.isFunction(e.isEqual))return e.isEqual(t);if(t.isEqual&&S.isFunction(t.isEqual))return t.isEqual(e);var r=a.call(e);if(r!=a.call(t))return!1;switch(r){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var i=n.length;while(i--)if(n[i]==e)return!0;n.push(e);var s=0,o=!0;if(r=="[object Array]"){s=e.length,o=s==t.length;if(o)while(s--)if(!(o=s in e==s in t&&C(e[s],t[s],n)))break}else{if("constructor"in e!="constructor"in t||e.constructor!=t.constructor)return!1;for(var u in e)if(S.has(e,u)){s++;if(!(o=S.has(t,u)&&C(e[u],t[u],n)))break}if(o){for(u in t)if(S.has(t,u)&&!(s--))break;o=!s}}return n.pop(),o}var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.slice,u=r.unshift,a=i.toString,f=i.hasOwnProperty,l=r.forEach,c=r.map,h=r.reduce,p=r.reduceRight,d=r.filter,v=r.every,m=r.some,g=r.indexOf,y=r.lastIndexOf,b=Array.isArray,w=Object.keys,E=s.bind,S=function(e){return new P(e)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=S),exports._=S):e._=S,S.VERSION="1.3.3";var x=S.each=S.forEach=function(e,t,r){if(e==null)return;if(l&&e.forEach===l)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(r,e[i],i,e)===n)return}else for(var o in e)if(S.has(e,o)&&t.call(r,e[o],o,e)===n)return};S.map=S.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(x(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},S.reduce=S.foldl=S.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=S.bind(t,r)),i?e.reduce(t,n):e.reduce(t);x(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},S.reduceRight=S.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=S.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=S.toArray(e).reverse();return r&&!i&&(t=S.bind(t,r)),i?S.reduce(s,t,n,r):S.reduce(s,t)},S.find=S.detect=function(e,t,n){var r;return T(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},S.filter=S.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(x(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},S.reject=function(e,t,n){var r=[];return e==null?r:(x(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},S.every=S.all=function(e,t,r){var i=!0;return e==null?i:v&&e.every===v?e.every(t,r):(x(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var T=S.some=S.any=function(e,t,r){t||(t=S.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,r):(x(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};S.include=S.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:(n=T(e,function(e){return e===t}),n)},S.invoke=function(e,t){var n=o.call(arguments,2);return S.map(e,function(e){return(S.isFunction(t)?t||e:e[t]).apply(e,n)})},S.pluck=function(e,t){return S.map(e,function(e){return e[t]})},S.max=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&S.isEmpty(e))return-Infinity;var r={computed:-Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},S.min=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&S.isEmpty(e))return Infinity;var r={computed:Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},S.shuffle=function(e){var t=[],n;return x(e,function(e,r,i){n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e}),t},S.sortBy=function(e,t,n){var r=S.isFunction(t)?t:function(e){return e[t]};return S.pluck(S.map(e,function(e,t,i){return{value:e,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n===void 0?1:r===void 0?-1:n<r?-1:n>r?1:0}),"value")},S.groupBy=function(e,t){var n={},r=S.isFunction(t)?t:function(e){return e[t]};return x(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},S.sortedIndex=function(e,t,n){n||(n=S.identity);var r=0,i=e.length;while(r<i){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},S.toArray=function(e){return e?S.isArray(e)?o.call(e):S.isArguments(e)?o.call(e):e.toArray&&S.isFunction(e.toArray)?e.toArray():S.values(e):[]},S.size=function(e){return S.isArray(e)?e.length:S.keys(e).length},S.first=S.head=S.take=function(e,t,n){return t!=null&&!n?o.call(e,0,t):e[0]},S.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},S.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},S.rest=S.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},S.compact=function(e){return S.filter(e,function(e){return!!e})},S.flatten=function(e,t){return S.reduce(e,function(e,n){return S.isArray(n)?e.concat(t?n:S.flatten(n)):(e[e.length]=n,e)},[])},S.without=function(e){return S.difference(e,o.call(arguments,1))},S.uniq=S.unique=function(e,t,n){var r=n?S.map(e,n):e,i=[];return e.length<3&&(t=!0),S.reduce(r,function(n,r,s){if(t?S.last(n)!==r||!n.length:!S.include(n,r))n.push(r),i.push(e[s]);return n},[]),i},S.union=function(){return S.uniq(S.flatten(arguments,!0))},S.intersection=S.intersect=function(e){var t=o.call(arguments,1);return S.filter(S.uniq(e),function(e){return S.every(t,function(t){return S.indexOf(t,e)>=0})})},S.difference=function(e){var t=S.flatten(o.call(arguments,1),!0);return S.filter(e,function(e){return!S.include(t,e)})},S.zip=function(){var e=o.call(arguments),t=S.max(S.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=S.pluck(e,""+r);return n},S.indexOf=function(e,t,n){if(e==null)return-1;var r,i;if(n)return r=S.sortedIndex(e,t),e[r]===t?r:-1;if(g&&e.indexOf===g)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(r in e&&e[r]===t)return r;return-1},S.lastIndexOf=function(e,t){if(e==null)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);var n=e.length;while(n--)if(n in e&&e[n]===t)return n;return-1},S.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var N=function(){};S.bind=function(t,n){var r,i;if(t.bind===E&&E)return E.apply(t,o.call(arguments,1));if(!S.isFunction(t))throw new TypeError;return i=o.call(arguments,2),r=function(){if(this instanceof r){N.prototype=t.prototype;var e=new N,s=t.apply(e,i.concat(o.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(o.call(arguments)))}},S.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=S.functions(e)),x(t,function(t){e[t]=S.bind(e[t],e)}),e},S.memoize=function(e,t){var n={};return t||(t=S.identity),function(){var r=t.apply(this,arguments);return S.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},S.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},S.defer=function(e){return S.delay.apply(S,[e,1].concat(o.call(arguments,1)))},S.throttle=function(e,t){var n,r,i,s,o,u,a=S.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var f=function(){i=null,o&&e.apply(n,r),a()};return i||(i=setTimeout(f,t)),s?o=!0:u=e.apply(n,r),a(),s=!0,u}},S.debounce=function(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,n||e.apply(i,s)};n&&!r&&e.apply(i,s),clearTimeout(r),r=setTimeout(o,t)}},S.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},S.wrap=function(e,t){return function(){var n=[e].concat(o.call(arguments,0));return t.apply(this,n)}},S.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},S.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},S.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)S.has(e,n)&&(t[t.length]=n);return t},S.values=function(e){return S.map(e,S.identity)},S.functions=S.methods=function(e){var t=[];for(var n in e)S.isFunction(e[n])&&t.push(n);return t.sort()},S.extend=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},S.pick=function(e){var t={};return x(S.flatten(o.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},S.defaults=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},S.clone=function(e){return S.isObject(e)?S.isArray(e)?e.slice():S.extend({},e):e},S.tap=function(e,t){return t(e),e},S.isEqual=function(e,t){return C(e,t,[])},S.isEmpty=function(e){if(e==null)return!0;if(S.isArray(e)||S.isString(e))return e.length===0;for(var t in e)if(S.has(e,t))return!1;return!0},S.isElement=function(e){return!!e&&e.nodeType==1},S.isArray=b||function(e){return a.call(e)=="[object Array]"},S.isObject=function(e){return e===Object(e)},S.isArguments=function(e){return a.call(e)=="[object Arguments]"},S.isArguments(arguments)||(S.isArguments=function(e){return!!e&&!!S.has(e,"callee")}),S.isFunction=function(e){return a.call(e)=="[object Function]"},S.isString=function(e){return a.call(e)=="[object String]"},S.isNumber=function(e){return a.call(e)=="[object Number]"},S.isFinite=function(e){return S.isNumber(e)&&isFinite(e)},S.isNaN=function(e){return e!==e},S.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},S.isDate=function(e){return a.call(e)=="[object Date]"},S.isRegExp=function(e){return a.call(e)=="[object RegExp]"},S.isNull=function(e){return e===null},S.isUndefined=function(e){return e===void 0},S.has=function(e,t){return f.call(e,t)},S.noConflict=function(){return e._=t,this},S.identity=function(e){return e},S.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},S.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},S.result=function(e,t){if(e==null)return null;var n=e[t];return S.isFunction(n)?n.call(e):n},S.mixin=function(e){x(S.functions(e),function(t){B(t,S[t]=e[t])})};var k=0;S.uniqueId=function(e){var t=k++;return e?e+t:t},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/.^/,A={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var O in A)A[A[O]]=O;var M=/\\|'|\r|\n|\t|\u2028|\u2029/g,_=/\\(\\|'|r|n|t|u2028|u2029)/g,D=function(e){return e.replace(_,function(e,t){return A[t]})};S.template=function(e,t,n){n=S.defaults(n||{},S.templateSettings);var r="__p+='"+e.replace(M,function(e){return"\\"+A[e]}).replace(n.escape||L,function(e,t){return"'+\n_.escape("+D(t)+")+\n'"}).replace(n.interpolate||L,function(e,t){return"'+\n("+D(t)+")+\n'"}).replace(n.evaluate||L,function(e,t){return"';\n"+D(t)+"\n;__p+='"})+"';\n";n.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+r+"return __p;\n";var i=new Function(n.variable||"obj","_",r);if(t)return i(t,S);var s=function(e){return i.call(this,e,S)};return s.source="function("+(n.variable||"obj")+"){\n"+r+"}",s},S.chain=function(e){return S(e).chain()};var P=function(e){this._wrapped=e};S.prototype=P.prototype;var H=function(e,t){return t?S(e).chain():e},B=function(e,t){P.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),H(t.apply(S,e),this._chain)}};S.mixin(S),x(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];P.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],H(n,this._chain)}}),x(["concat","join","slice"],function(e){var t=r[e];P.prototype[e]=function(){return H(t.apply(this._wrapped,arguments),this._chain)}}),P.prototype.chain=function(){return this._chain=!0,this},P.prototype.value=function(){return this._wrapped},typeof define=="function"&&define.amd&&define("underscore",[],function(){var e=S;return e._=S,e})}.call(this),define("underscore",["underscore/underscore"],function(e){return e}),define("underscore/underscore",function(){}),function(){var e={},t=this,n=t.async;e.noConflict=function(){return t.async=n,e};var r=function(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n+=1)t(e[n],n,e)},i=function(e,t){if(e.map)return e.map(t);var n=[];return r(e,function(e,r,i){n.push(t(e,r,i))}),n},s=function(e,t,n){return e.reduce?e.reduce(t,n):(r(e,function(e,r,i){n=t(n,e,r,i)}),n)},o=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};typeof process=="undefined"||!process.nextTick?e.nextTick=function(e){setTimeout(e,0)}:e.nextTick=process.nextTick,e.forEach=function(e,t,n){n=n||function(){};if(!e.length)return n();var i=0;r(e,function(r){t(r,function(t){t?(n(t),n=function(){}):(i+=1,i===e.length&&n(null))})})},e.forEachSeries=function(e,t,n){n=n||function(){};if(!e.length)return n();var r=0,i=function(){t(e[r],function(t){t?(n(t),n=function(){}):(r+=1,r===e.length?n(null):i())})};i()},e.forEachLimit=function(e,t,n,r){r=r||function(){};if(!e.length||t<=0)return r();var i=0,s=0,o=0;(function u(){if(i===e.length)return r();while(o<t&&s<e.length)s+=1,o+=1,n(e[s-1],function(t){t?(r(t),r=function(){}):(i+=1,o-=1,i===e.length?r():u())})})()};var u=function(t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[e.forEach].concat(n))}},a=function(t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[e.forEachSeries].concat(n))}},f=function(e,t,n,r){var s=[];t=i(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n,r){s[e.index]=r,t(n)})},function(e){r(e,s)})};e.map=u(f),e.mapSeries=a(f),e.reduce=function(t,n,r,i){e.forEachSeries(t,function(e,t){r(n,e,function(e,r){n=r,t(e)})},function(e){i(e,n)})},e.inject=e.reduce,e.foldl=e.reduce,e.reduceRight=function(t,n,r,s){var o=i(t,function(e){return e}).reverse();e.reduce(o,n,r,s)},e.foldr=e.reduceRight;var l=function(e,t,n,r){var s=[];t=i(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n&&s.push(e),t()})},function(e){r(i(s.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};e.filter=u(l),e.filterSeries=a(l),e.select=e.filter,e.selectSeries=e.filterSeries;var c=function(e,t,n,r){var s=[];t=i(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n||s.push(e),t()})},function(e){r(i(s.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};e.reject=u(c),e.rejectSeries=a(c);var h=function(e,t,n,r){e(t,function(e,t){n(e,function(n){n?(r(e),r=function(){}):t()})},function(e){r()})};e.detect=u(h),e.detectSeries=a(h),e.some=function(t,n,r){e.forEach(t,function(e,t){n(e,function(e){e&&(r(!0),r=function(){}),t()})},function(e){r(!1)})},e.any=e.some,e.every=function(t,n,r){e.forEach(t,function(e,t){n(e,function(e){e||(r(!1),r=function(){}),t()})},function(e){r(!0)})},e.all=e.every,e.sortBy=function(t,n,r){e.map(t,function(e,t){n(e,function(n,r){n?t(n):t(null,{value:e,criteria:r})})},function(e,t){if(e)return r(e);var n=function(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0};r(null,i(t.sort(n),function(e){return e.value}))})},e.auto=function(e,t){t=t||function(){};var n=o(e);if(!n.length)return t(null);var i={},u=[],a=function(e){u.unshift(e)},f=function(e){for(var t=0;t<u.length;t+=1)if(u[t]===e){u.splice(t,1);return}},l=function(){r(u.slice(0),function(e){e()})};a(function(){o(i).length===n.length&&(t(null,i),t=function(){})}),r(n,function(n){var r=e[n]instanceof Function?[e[n]]:e[n],o=function(e){if(e)t(e),t=function(){};else{var r=Array.prototype.slice.call(arguments,1);r.length<=1&&(r=r[0]),i[n]=r,l()}},u=r.slice(0,Math.abs(r.length-1))||[],c=function(){return s(u,function(e,t){return e&&i.hasOwnProperty(t)},!0)&&!i.hasOwnProperty(n)};if(c())r[r.length-1](o,i);else{var h=function(){c()&&(f(h),r[r.length-1](o,i))};a(h)}})},e.waterfall=function(t,n){n=n||function(){};if(!t.length)return n();var r=function(t){return function(i){if(i)n(i),n=function(){};else{var s=Array.prototype.slice.call(arguments,1),o=t.next();o?s.push(r(o)):s.push(n),e.nextTick(function(){t.apply(null,s)})}}};r(e.iterator(t))()},e.parallel=function(t,n){n=n||function(){};if(t.constructor===Array)e.map(t,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},n);else{var r={};e.forEach(o(t),function(e,n){t[e](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[e]=i,n(t)})},function(e){n(e,r)})}},e.series=function(t,n){n=n||function(){};if(t.constructor===Array)e.mapSeries(t,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},n);else{var r={};e.forEachSeries(o(t),function(e,n){t[e](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[e]=i,n(t)})},function(e){n(e,r)})}},e.iterator=function(e){var t=function(n){var r=function(){return e.length&&e[n].apply(null,arguments),r.next()};return r.next=function(){return n<e.length-1?t(n+1):null},r};return t(0)},e.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var p=function(e,t,n,r){var i=[];e(t,function(e,t){n(e,function(e,n){i=i.concat(n||[]),t(e)})},function(e){r(e,i)})};e.concat=u(p),e.concatSeries=a(p),e.whilst=function(t,n,r){t()?n(function(i){if(i)return r(i);e.whilst(t,n,r)}):r()},e.until=function(t,n,r){t()?r():n(function(i){if(i)return r(i);e.until(t,n,r)})},e.queue=function(t,n){var i=0,s={tasks:[],concurrency:n,saturated:null,empty:null,drain:null,push:function(t,i){t.constructor!==Array&&(t=[t]),r(t,function(t){s.tasks.push({data:t,callback:typeof i=="function"?i:null}),s.saturated&&s.tasks.length==n&&s.saturated(),e.nextTick(s.process)})},process:function(){if(i<s.concurrency&&s.tasks.length){var e=s.tasks.shift();s.empty&&s.tasks.length==0&&s.empty(),i+=1,t(e.data,function(){i-=1,e.callback&&e.callback.apply(e,arguments),s.drain&&s.tasks.length+i==0&&s.drain(),s.process()})}},length:function(){return s.tasks.length},running:function(){return i}};return s};var d=function(e){return function(t){var n=Array.prototype.slice.call(arguments,1);t.apply(null,n.concat([function(t){var n=Array.prototype.slice.call(arguments,1);typeof console!="undefined"&&(t?console.error&&console.error(t):console[e]&&r(n,function(t){console[e](t)}))}]))}};e.log=d("log"),e.dir=d("dir"),e.memoize=function(e,t){var n={},r={};t=t||function(e){return e};var i=function(){var i=Array.prototype.slice.call(arguments),s=i.pop(),o=t.apply(null,i);o in n?s.apply(null,n[o]):o in r?r[o].push(s):(r[o]=[s],e.apply(null,i.concat([function(){n[o]=arguments;var e=r[o];delete r[o];for(var t=0,i=e.length;t<i;t++)e[t].apply(null,arguments)}])))};return i.unmemoized=e,i},e.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},typeof define!="undefined"&&define.amd?define("async",[],function(){return e}):typeof module!="undefined"&&module.exports?module.exports=e:t.async=e}(),define("async",["async/lib/async"],function(e){return e}),define("async/lib/async",function(){}),define("simple-uuid",[],function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),t={};return t.uuid=function(t,n){var r=e,i=[];n=n||r.length;if(t)for(var s=0;s<t;s++)i[s]=r[0|Math.random()*n];else{var o;i[8]=i[13]=i[18]=i[23]="-",i[14]="4";for(var s=0;s<36;s++)i[s]||(o=0|Math.random()*16,i[s]=r[s==19?o&3|8:o])}return i.join("")},t.uuidFast=function(){var t=e,n=new Array(36),r=0,i;for(var s=0;s<36;s++)s==8||s==13||s==18||s==23?n[s]="-":s==14?n[s]="4":(r<=2&&(r=33554432+Math.random()*16777216|0),i=r&15,r>>=4,n[s]=t[s==19?i&3|8:i]);return n.join("")},t.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)}).toUpperCase()},t}),define("simple-uuid",["simple-uuid/uuid"],function(e){return e}),define("simple-uuid/uuid",function(){}),function(){function i(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;var n=1732584193,r=-271733879,i=-1732584194,s=271733878;for(var l=0;l<e.length;l+=16){var h=n,p=r,d=i,v=s;n=o(n,r,i,s,e[l+0],7,-680876936),s=o(s,n,r,i,e[l+1],12,-389564586),i=o(i,s,n,r,e[l+2],17,606105819),r=o(r,i,s,n,e[l+3],22,-1044525330),n=o(n,r,i,s,e[l+4],7,-176418897),s=o(s,n,r,i,e[l+5],12,1200080426),i=o(i,s,n,r,e[l+6],17,-1473231341),r=o(r,i,s,n,e[l+7],22,-45705983),n=o(n,r,i,s,e[l+8],7,1770035416),s=o(s,n,r,i,e[l+9],12,-1958414417),i=o(i,s,n,r,e[l+10],17,-42063),r=o(r,i,s,n,e[l+11],22,-1990404162),n=o(n,r,i,s,e[l+12],7,1804603682),s=o(s,n,r,i,e[l+13],12,-40341101),i=o(i,s,n,r,e[l+14],17,-1502002290),r=o(r,i,s,n,e[l+15],22,1236535329),n=u(n,r,i,s,e[l+1],5,-165796510),s=u(s,n,r,i,e[l+6],9,-1069501632),i=u(i,s,n,r,e[l+11],14,643717713),r=u(r,i,s,n,e[l+0],20,-373897302),n=u(n,r,i,s,e[l+5],5,-701558691),s=u(s,n,r,i,e[l+10],9,38016083),i=u(i,s,n,r,e[l+15],14,-660478335),r=u(r,i,s,n,e[l+4],20,-405537848),n=u(n,r,i,s,e[l+9],5,568446438),s=u(s,n,r,i,e[l+14],9,-1019803690),i=u(i,s,n,r,e[l+3],14,-187363961),r=u(r,i,s,n,e[l+8],20,1163531501),n=u(n,r,i,s,e[l+13],5,-1444681467),s=u(s,n,r,i,e[l+2],9,-51403784),i=u(i,s,n,r,e[l+7],14,1735328473),r=u(r,i,s,n,e[l+12],20,-1926607734),n=a(n,r,i,s,e[l+5],4,-378558),s=a(s,n,r,i,e[l+8],11,-2022574463),i=a(i,s,n,r,e[l+11],16,1839030562),r=a(r,i,s,n,e[l+14],23,-35309556),n=a(n,r,i,s,e[l+1],4,-1530992060),s=a(s,n,r,i,e[l+4],11,1272893353),i=a(i,s,n,r,e[l+7],16,-155497632),r=a(r,i,s,n,e[l+10],23,-1094730640),n=a(n,r,i,s,e[l+13],4,681279174),s=a(s,n,r,i,e[l+0],11,-358537222),i=a(i,s,n,r,e[l+3],16,-722521979),r=a(r,i,s,n,e[l+6],23,76029189),n=a(n,r,i,s,e[l+9],4,-640364487),s=a(s,n,r,i,e[l+12],11,-421815835),i=a(i,s,n,r,e[l+15],16,530742520),r=a(r,i,s,n,e[l+2],23,-995338651),n=f(n,r,i,s,e[l+0],6,-198630844),s=f(s,n,r,i,e[l+7],10,1126891415),i=f(i,s,n,r,e[l+14],15,-1416354905),r=f(r,i,s,n,e[l+5],21,-57434055),n=f(n,r,i,s,e[l+12],6,1700485571),s=f(s,n,r,i,e[l+3],10,-1894986606),i=f(i,s,n,r,e[l+10],15,-1051523),r=f(r,i,s,n,e[l+1],21,-2054922799),n=f(n,r,i,s,e[l+8],6,1873313359),s=f(s,n,r,i,e[l+15],10,-30611744),i=f(i,s,n,r,e[l+6],15,-1560198380),r=f(r,i,s,n,e[l+13],21,1309151649),n=f(n,r,i,s,e[l+4],6,-145523070),s=f(s,n,r,i,e[l+11],10,-1120210379),i=f(i,s,n,r,e[l+2],15,718787259),r=f(r,i,s,n,e[l+9],21,-343485551),n=c(n,h),r=c(r,p),i=c(i,d),s=c(s,v)}return Array(n,r,i,s)}function s(e,t,n,r,i,s){return c(h(c(c(t,e),c(r,s)),i),n)}function o(e,t,n,r,i,o,u){return s(t&n|~t&r,e,t,i,o,u)}function u(e,t,n,r,i,o,u){return s(t&r|n&~r,e,t,i,o,u)}function a(e,t,n,r,i,o,u){return s(t^n^r,e,t,i,o,u)}function f(e,t,n,r,i,o,u){return s(n^(t|~r),e,t,i,o,u)}function l(e,t){var n=p(e);n.length>16&&(n=i(n,e.length*r));var s=Array(16),o=Array(16);for(var u=0;u<16;u++)s[u]=n[u]^909522486,o[u]=n[u]^1549556828;var a=i(s.concat(p(t)),512+t.length*r);return i(o.concat(a),640)}function c(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}function h(e,t){return e<<t|e>>>32-t}function p(e){var t=Array(),n=(1<<r)-1;for(var i=0;i<e.length*r;i+=r)t[i>>5]|=(e.charCodeAt(i/r)&n)<<i%32;return t}function d(e){var t="",n=(1<<r)-1;for(var i=0;i<e.length*32;i+=r)t+=String.fromCharCode(e[i>>5]>>>i%32&n);return t}function v(e){var n=t?"0123456789ABCDEF":"0123456789abcdef",r="";for(var i=0;i<e.length*4;i++)r+=n.charAt(e[i>>2]>>i%4*8+4&15)+n.charAt(e[i>>2]>>i%4*8&15);return r}function m(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="";for(var i=0;i<e.length*4;i+=3){var s=(e[i>>2]>>8*(i%4)&255)<<16|(e[i+1>>2]>>8*((i+1)%4)&255)<<8|e[i+2>>2]>>8*((i+2)%4)&255;for(var o=0;o<4;o++)i*8+o*6>e.length*32?r+=n:r+=t.charAt(s>>6*(3-o)&63)}return r}function g(e){e||(e={}),t=e.hexcase===undefined?0:e.hexcase,n=e.b64pad===undefined?"":e.b64pad,r=e.chrsz===undefined?8:e.chrsz}var e={},t=0,n="",r=8;e.hex=function(e,t){return g(t),v(i(p(e),e.length*r))},e.base64=function(e,t){return g(t),m(i(p(e),e.length*r))},e.str=function(e,t){return g(t),d(i(p(e),e.length*r))},e.hex_hmac=function(e,t,n){return g(n),v(l(e,t))},e.base64_hmac=function(e,t,n){return g(n),m(l(e,t))},e.str_hmac=function(e,t,n){return g(n),d(l(e,t))},e.vm_test=function(){return g(),e.hex("abc")=="900150983cd24fb0d6963f7d28e17f72"},typeof define!="undefined"&&define.amd?define("md5",[],function(){return e}):typeof module!="undefined"&&typeof exports!="undefined"?module.exports=e:this.md5=e}(),define("md5",["md5/md5"],function(e){return e}),define("md5/md5",function(){}),define("pouchdb",["simple-uuid","md5"],function(uuid,md5){function parseUri(e){var t=parseUri.options,n=t.parser[t.strictMode?"strict":"loose"].exec(e),r={},i=14;while(i--)r[t.key[i]]=n[i]||"";return r[t.q.name]={},r[t.key[12]].replace(t.q.parser,function(e,n,i){n&&(r[t.q.name][n]=i)}),r}function getHost(e){if(/http(s?):/.test(e)){var t=parseUri(e);t.remote=!0;if(t.user||t.password)t.auth={username:t.user,password:t.password};var n=t.path.replace(/(^\/|\/$)/g,"").split("/");return t.db=n.pop(),t.path=n.join("/"),t}return{host:"",path:"/",db:e,auth:!1}}function genDBUrl(e,t){if(e.remote){var n=e.path?"/":"";return e.protocol+"://"+e.host+":"+e.port+"/"+e.path+n+e.db+"/"+t}return"/"+e.db+"/"+t}function genUrl(e,t){return e.remote?e.protocol+"://"+e.host+":"+e.port+"/"+t:"/"+t}function quote(e){return"'"+e+"'"}Math.uuid=uuid.uuid,Crypto={MD5:md5.hex};var Pouch=function Pouch(e,t,n){if(!(this instanceof Pouch))return new Pouch(e,t,n);if(typeof t=="function"||typeof t=="undefined")n=t,t={};typeof e=="object"&&(t=e,e=undefined);var r=Pouch.parseAdapter(t.name||e);t.name=t.name||r.name,t.adapter=t.adapter||r.adapter;if(!Pouch.adapters[t.adapter])throw"Adapter is missing";if(!Pouch.adapters[t.adapter].valid())throw"Invalid Adapter";var i=Pouch.adapters[t.adapter](t,function(e,t){if(e){n&&n(e);return}for(var r in Pouch.plugins){var i=Pouch.plugins[r](t);for(var s in i)s in t||(t[s]=i[s])}n(null,t)});for(var s in i)this[s]=i[s]};Pouch.DEBUG=!1,Pouch.adapters={},Pouch.plugins={},Pouch.parseAdapter=function(e){var t=e.match(/([a-z\-]*):\/\/(.*)/);if(t){e=/http(s?)/.test(t[1])?t[1]+"://"+t[2]:t[2];var n=t[1];if(!Pouch.adapters[n].valid())throw"Invalid adapter";return{name:e,adapter:t[1]}}var r={idb:1,leveldb:2,websql:3,http:4,https:4},i=Object.keys(Pouch.adapters).sort(function(e,t){return r[e]-r[t]})[0];return{name:e,adapter:i}},Pouch.destroy=function(e,t){for(var n in Pouch.plugins)Pouch.plugins[n]._delete(e);var r=Pouch.parseAdapter(e);Pouch.adapters[r.adapter].destroy(r.name,t)},Pouch.adapter=function(e,t){t.valid()&&(Pouch.adapters[e]=t)},Pouch.plugin=function(e,t){Pouch.plugins[e]=t},Pouch.Errors={MISSING_BULK_DOCS:{status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"},MISSING_DOC:{status:404,error:"not_found",reason:"missing"},REV_CONFLICT:{status:409,error:"conflict",reason:"Document update conflict"},INVALID_ID:{status:400,error:"invalid_id",reason:"_id field must contain a string"},MISSING_ID:{status:412,error:"missing_id",reason:"_id is required for puts"},RESERVED_ID:{status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."},NOT_OPEN:{status:412,error:"precondition_failed",reason:"Database not open so cannot close"},UNKNOWN_ERROR:{status:500,error:"unknown_error",reason:"Database encountered an unknown error"},INVALID_REQUEST:{status:400,error:"invalid_request",reason:"Request was invalid"}};if(typeof module!="undefined"&&module.exports){global.Pouch=Pouch,Pouch.merge=require("./pouch.merge.js").merge,Pouch.collate=require("./pouch.collate.js").collate,Pouch.replicate=require("./pouch.replicate.js").replicate,Pouch.utils=require("./pouch.utils.js"),module.exports=Pouch;var adapters=["leveldb","http"];adapters.map(function(e){var t="./adapters/pouch."+e+".js";require(t)}),require("./plugins/pouchdb.mapreduce.js")}else this.Pouch=Pouch;(function(){typeof module!="undefined"&&module.exports&&(module.exports=Pouch),Pouch.collate=function(i,s){var o=r(i),u=r(s);if(o-u!==0)return o-u;if(i===null)return 0;if(typeof i=="number")return i-s;if(typeof i=="boolean")return i<s?-1:1;if(typeof i=="string")return e(i,s);if(Array.isArray(i))return n(i,s);if(typeof i=="object")return t(i,s)};var e=function(e,t){return e===t?0:e>t?1:-1},t=function(e,t){var n=Object.keys(e),r=Object.keys(t),i=Math.min(n.length,r.length);for(var s=0;s<i;s++){var o=Pouch.collate(n[s],r[s]);if(o!==0)return o;o=Pouch.collate(e[n[s]],t[r[s]]);if(o!==0)return o}return n.length===r.length?0:n.length>r.length?1:-1},n=function(e,t){var n=Math.min(e.length,t.length);for(var r=0;r<n;r++){var i=Pouch.collate(e[r],t[r]);if(i!==0)return i}return e.length===t.length?0:e.length>t.length?1:-1},r=function(e){var t=["boolean","number","string","object"];if(t.indexOf(typeof e)!==-1)return e===null?1:t.indexOf(typeof e)+2;if(Array.isArray(e))return 4.5}}).call(this),function(){function n(e){var t=[e.shift(),[]],n=t;while(e.length)nleaf=[e.shift(),[]],n[1].push(nleaf),n=nleaf;return t}function r(e,t){var r=rootToLeaf(e).map(function(e){var r=e.ids.slice(-t);return{pos:e.pos+(e.ids.length-r.length),ids:n(r)}});return r.reduce(function(e,t,n,r){return s(e,t,!0).tree},[r.shift()])}function i(e,t){var n=[{tree1:e,tree2:t}],r=!1;while(n.length>0){var i=n.pop(),s=i.tree1,o=i.tree2;for(var u=0;u<o[1].length;u++){if(!s[1][0]){r="new_leaf",s[1][0]=o[1][u];continue}var a=!1;for(var f=0;f<s[1].length;f++)s[1][f][0]==o[1][u][0]&&(n.push({tree1:s[1][f],tree2:o[1][u]}),a=!0);a||(r="new_branch",s[1].push(o[1][u]),s[1].sort())}}return{conflicts:r,tree:e}}function s(e,t,n){var r=[],s=!1,o=!1,u,a;return e.length?(e.forEach(function(e){if(e.pos===t.pos&&e.ids[0]===t.ids[0])u=i(e.ids,t.ids),r.push({pos:e.pos,ids:u.tree}),s=s||u.conflicts,o=!0;else if(n!==!0){var a=e.pos<t.pos?e:t,f=e.pos<t.pos?t:e,l=f.pos-a.pos,c=[],h=[];h.push({ids:a.ids,diff:l,parent:null,parentIdx:null});while(h.length>0){var p=h.pop();if(p.diff==0){p.ids[0]==f.ids[0]&&c.push(p);continue}if(!p.ids)continue;p.ids[1].forEach(function(e,t){h.push({ids:e,diff:p.diff-1,parent:p.ids,parentIdx:t})})}var d=c[0];d?(u=i(d.ids,f.ids),d.parent[1][d.parentIdx]=u.tree,r.push({pos:a.pos,ids:a.ids}),s=s||u.conflicts,o=!0):r.push(e)}else r.push(e)}),o||r.push(t),r.sort(function(e,t){return e.pos-t.pos}),{tree:r,conflicts:s||"internal_node"}):{tree:[t],conflicts:"new_leaf"}}if(typeof module!="undefined"&&module.exports){module.exports=Pouch;var e=require("./pouch.utils.js");for(var t in e)global[t]=e[t]}Pouch.merge=function(e,t,n){e=extend(!0,[],e),t=extend(!0,{},t);var i=s(e,t);return{tree:r(i.tree,n),conflicts:i.conflicts}},Pouch.merge.winningRev=function(e){var t=e.deletions||{},n=[];return traverseRevTree(e.rev_tree,function(e,t,r){e&&n.push({pos:t,id:r})}),n.forEach(function(e){e.deleted=e.id in t}),n.sort(function(e,t){return e.deleted!==t.deleted?e.deleted>t.deleted?1:-1:e.pos!==t.pos?t.pos-e.pos:e.id<t.id?1:-1}),n[0].pos+"-"+n[0].id}}.call(this),typeof module!="undefined"&&module.exports&&(module.exports=Pouch),function(){function e(e,t,n,r,i){fetchCheckpoint(e,t,n,function(s){function h(){u&&a===0&&(c.end_time=new Date,writeCheckpoint(e,t,n,f,function(){call(r,null,c)}))}var o=[],u=!1,a=0,f=s,l=n.continuous||!1,c={ok:!0,start_time:new Date,docs_read:0,docs_written:0};if(i.cancelled)return;var p={continuous:l,since:s,style:"all_docs",onChange:function(s){f=s.seq,o.push(s),c.docs_read++,a++;var u={};u[s.id]=s.changes.map(function(e){return e.rev}),t.revsDiff(u,function(s,o){if(s){l&&i.cancel(),call(r,s,null);return}if(Object.keys(o).length===0){a--,h();return}for(var u in o)o[u].missing.map(function(r){e.get(u,{revs:!0,rev:r,attachments:!0},function(e,r){t.bulkDocs({docs:[r]},{new_edits:!1},function(){n.onChange&&n.onChange.apply(this,[c]),c.docs_written++,a--,h()})})})})},complete:function(e,t){u=!0,h()}};n.filter&&(p.filter=n.filter),n.query_params&&(p.query_params=n.query_params);var d=e.changes(p);n.continuous&&(i.cancel=d.cancel)})}function t(e,t){if(typeof e=="string")return new Pouch(e,t);t(null,e)}Pouch.replicate=function(n,r,i,s){i instanceof Function&&(s=i,i={}),i===undefined&&(i={});var o=function(){this.cancelled=!1,this.cancel=function(){this.cancelled=!0}},u=new o;return t(n,function(n,o){if(n)return call(s,n);t(r,function(t,n){if(t)return call(s,t);e(o,n,i,s,u)})}),u}}.call(this);var call=function(e){var t=Array.prototype.slice.call(arguments,1);typeof e==typeof Function&&e.apply(this,t)},yankError=function(e){return function(t,n){t||n[0].error?call(e,t||n[0]):call(e,null,n[0])}},isAttachmentId=function(e){return/\//.test(e)&&!/^_local/.test(e)&&!/^_design/.test(e)},parseDocId=function(e){var t=typeof e=="string"&&!/^_(design|local)\//.test(e)?e.split("/"):[e];return{docId:t[0],attachmentId:t.splice(1).join("/").replace(/^\/+/,"")}},isDeleted=function(e,t){return!e||!e.deletions?!1:(t||(t=Pouch.merge.winningRev(e)),t.indexOf("-")>=0&&(t=t.split("-")[1]),e.deletions[t]===!0)},isValidId=function(e){return/^_/.test(e)?/^_(design|local)/.test(e):!0},parseDoc=function(e,t){var n=null;if(e._id){var r=parseDocId(e._id);if(r.attachmentId!==""){var i=btoa(JSON.stringify(e));e={_id:r.docId},e._attachments||(e._attachments={}),e._attachments[r.attachmentId]={content_type:"application/json",data:i}}}if(t){e._id||(e._id=Math.uuid());var s=Math.uuid(32,16).toLowerCase(),o;if(e._rev){var u=/^(\d+)-(.+)$/.exec(e._rev);if(!u)throw"invalid value for property '_rev'";e._rev_tree=[{pos:parseInt(u[1],10),ids:[u[2],[[s,[]]]]}],o=parseInt(u[1],10)+1}else e._rev_tree=[{pos:1,ids:[s,[]]}],o=1}else{e._revisions&&(e._rev_tree=[{pos:e._revisions.start-e._revisions.ids.length+1,ids:e._revisions.ids.reduce(function(e,t){return e===null?[t,[]]:[t,[e]]},null)}],o=e._revisions.start,s=e._revisions.ids[0]);if(!e._rev_tree){var u=/^(\d+)-(.+)$/.exec(e._rev);o=parseInt(u[1],10),s=u[2],e._rev_tree=[{pos:parseInt(u[1],10),ids:[u[2],[]]}]}}return typeof e._id!="string"?n=Pouch.Errors.INVALID_ID:isValidId(e._id)||(n=Pouch.Errors.RESERVED_ID),e._id=decodeURIComponent(e._id),e._rev=[o,s].join("-"),n?n:Object.keys(e).reduce(function(t,n){return/^_/.test(n)&&n!=="_attachments"?t.metadata[n.slice(1)]=e[n]:t.data[n]=e[n],t},{metadata:{},data:{}})},compareRevs=function(e,t){return e.id!==t.id?e.id<t.id?-1:1:e.deleted^t.deleted?e.deleted?-1:1:e.rev_tree[0].pos===t.rev_tree[0].pos?e.rev_tree[0].ids<t.rev_tree[0].ids?-1:1:e.rev_tree[0].start<t.rev_tree[0].start?-1:1},traverseRevTree=function(e,t){var n=[];e.forEach(function(e){n.push({pos:e.pos,ids:e.ids})});while(n.length>0){var r=n.pop(),i=r.pos,s=r.ids,o=t(s[1].length==0,i,s[0],r.ctx);s[1].forEach(function(e){n.push({pos:i+1,ids:e,ctx:o})})}},collectRevs=function(e){var t=[];return traverseRevTree([e],function(e,n,r){t.push({rev:n+"-"+r,status:"available"})}),t},collectLeaves=function(e){var t=[];return traverseRevTree(e,function(e,n,r){e&&t.unshift({rev:n+"-"+r,pos:n})}),t.sort(function(e,t){return t.pos-e.pos}),t.map(function(e){delete e.pos}),t},collectConflicts=function(e){var t=collectLeaves(e);return t.shift(),t.map(function(e){return e.rev})},fetchCheckpoint=function(e,t,n,r){var i="";typeof n.filter!="undefined"&&(i=n.filter.toString());var s=Crypto.MD5(e.id()+t.id()+i);e.get("_local/"+s,function(e,t){e&&e.status===404?r(0):r(t.last_seq)})},writeCheckpoint=function(e,t,n,r,i){var s="";typeof n.filter!="undefined"&&(s=n.filter.toString());var o={_id:"_local/"+Crypto.MD5(e.id()+t.id()+s),last_seq:r};e.get(o._id,function(t,n){n&&n._rev&&(o._rev=n._rev),e.put(o,function(e,t){i()})})},arrayFirst=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n)===!0)return e[n];return!1},filterChange=function(e){return function(t){if(e.filter&&!e.filter.call(this,t.doc))return;e.include_docs||delete t.doc,call(e.onChange,t)}},rootToLeaf=function(e){var t=[];return traverseRevTree(e,function(e,n,r,i){i=i?i.slice(0):[],i.push(r);if(e){var s=n+1-i.length;t.unshift({pos:s,ids:i})}return i}),t},ajax=function(t,n){typeof t=="function"&&(n=t,t={});var r={method:"GET",headers:{},json:!0,timeout:1e4};t=extend(!0,r,t);if(t.auth){var i=btoa(t.auth.username+":"+t.auth.password);t.headers.Authorization="Basic "+i}var s=function(e,n,r){!t.json&&typeof e!="string"?e=JSON.stringify(e):t.json&&typeof e=="string"&&(e=JSON.parse(e)),call(r,null,e,n)},o=function(e,t){var n,r=e.responseText?{status:e.status}:e;try{n=JSON.parse(e.responseText),r=extend(!0,{},r,n)}catch(i){}call(t,r)};if(typeof window!="undefined"&&window.XMLHttpRequest){var u,a=!1,f=new XMLHttpRequest;f.open(t.method,t.url),t.json&&(t.headers.Accept="application/json",t.headers["Content-Type"]="application/json",t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)));for(var l in t.headers)f.setRequestHeader(l,t.headers[l]);"body"in t||(t.body=null);var c=function(){a=!0,f.abort(),call(o,f,n)};return f.onreadystatechange=function(){if(f.readyState!==4||a)return;clearTimeout(u),f.status>=200&&f.status<300?call(s,f.responseText,f,n):call(o,f,n)},t.timeout>0&&(u=setTimeout(c,t.timeout)),f.send(t.body),{abort:c}}return t.json&&(t.headers.Accept="application/json",t.headers["Content-Type"]="application/json"),request(t,function(e,r,i){if(e)return e.status=r?r.statusCode:400,call(o,e,n);var u=r.headers["content-type"],a=i||"";t.json&&typeof a!="object"&&(/json/.test(u)||/^[\s]*{/.test(a)&&/}[\s]*$/.test(a))&&(a=JSON.parse(a)),a.error?(a.status=r.statusCode,call(o,a,n)):call(s,a,r,n)})},class2type={},types=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"];for(var i=0;i<types.length;i++){var typename=types[i];class2type["[object "+typename+"]"]=typename.toLowerCase()}var core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,type=function(e){return e===null?String(e):typeof e=="object"||typeof e=="function"?class2type[core_toString.call(e)]||"object":typeof e},isPlainObject=function(e){if(!e||type(e)!=="object"||e.nodeType||isWindow(e))return!1;try{if(e.constructor&&!core_hasOwn.call(e,"constructor")&&!core_hasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var n;for(n in e);return n===undefined||core_hasOwn.call(e,n)},isFunction=function(e){return type(e)==="function"},isWindow=function(e){return e!=null&&e==e.window},isArray=Array.isArray||function(e){return type(e)==="array"},extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[1]||{},u=2),typeof o!="object"&&!isFunction(o)&&(o={}),a===u&&(o=this,--u);for(;u<a;u++)if((e=arguments[u])!=null)for(t in e){n=o[t],r=e[t];if(o===r)continue;f&&r&&(isPlainObject(r)||(i=isArray(r)))?(i?(i=!1,s=n&&isArray(n)?n:[]):s=n&&isPlainObject(n)?n:{},o[t]=extend(f,s,r)):r!==undefined&&(o[t]=r)}return o},win=this,localJSON=function(){return win.localStorage?{set:function(e,t){localStorage.setItem(e,JSON.stringify(t))},get:function(e,t){try{return localStorage.getItem(e)===null?t:JSON.parse(localStorage.getItem(e)||"false")}catch(n){return t}},remove:function(e){localStorage.removeItem(e)}}:!1}();typeof btoa=="undefined"&&(btoa=function(e){return(new Buffer(unescape(encodeURIComponent(e)),"binary")).toString("base64")}),typeof atob=="undefined"&&(atob=function(e){return decodeURIComponent(escape((new Buffer(e,"base64")).toString("binary")))});if(typeof module!="undefined"&&module.exports){var crypto=require("crypto"),Crypto={MD5:function(e){return crypto.createHash("md5").update(e).digest("hex")}};request=require("request"),_=require("underscore"),$=_,module.exports={Crypto:Crypto,call:call,yankError:yankError,isAttachmentId:isAttachmentId,parseDocId:parseDocId,parseDoc:parseDoc,isDeleted:isDeleted,compareRevs:compareRevs,collectRevs:collectRevs,collectLeaves:collectLeaves,collectConflicts:collectConflicts,fetchCheckpoint:fetchCheckpoint,writeCheckpoint:writeCheckpoint,arrayFirst:arrayFirst,filterChange:filterChange,ajax:ajax,atob:atob,btoa:btoa,extend:extend,traverseRevTree:traverseRevTree,rootToLeaf:rootToLeaf,isPlainObject:isPlainObject,isArray:isArray}}var Changes=function(){var e={},t={};return window.addEventListener("storage",function(t){e.notify(t.key)}),e.addListener=function(e,n,r,i){t[e]||(t[e]={}),t[e][n]={db:r,opts:i}},e.removeListener=function(e,n){delete t[e][n]},e.clearListeners=function(e){delete t[e]},e.notify=function(e){if(!t[e])return;for(var n in t[e]){var r=t[e][n].opts;t[e][n].db.changes({include_docs:r.include_docs,conflicts:r.conflicts,continuous:!1,filter:r.filter,since:r.since,onChange:function(e){e.seq>r.since&&(r.since=e.seq,call(r.onChange,e))}})}},e},HTTP_TIMEOUT=1e4;parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var HttpPouch=function(e,t){var n=getHost(e.name);e.auth&&(n.auth=e.auth);var r=genDBUrl(n,""),i={},s={list:[],get:function(e,t){typeof e=="function"&&(t=e,e={count:10});var r=function(e,n){!e&&"uuids"in n?(s.list=s.list.concat(n.uuids),call(t,null,"OK")):call(t,e||Pouch.Errors.UNKNOWN_ERROR)},i="?count="+e.count;ajax({auth:n.auth,method:"GET",url:genUrl(n,"_uuids")+i},r)}},o=function(){ajax({auth:n.auth,method:"PUT",url:r},function(e,s){e&&e.status===401?ajax({auth:n.auth,method:"HEAD",url:r},function(e,n){e?call(t,e):call(t,null,i)}):!e||e.status===412?call(t,null,i):call(t,Pouch.Errors.UNKNOWN_ERROR)})};return ajax({auth:n.auth,method:"GET",url:r},function(e,n){e?e.status===404?o():call(t,e):call(t,null,i)}),i.type=function(){return"http"},i.id=function(){return genDBUrl(n,"")},i.request=function(e,t){e.auth=n.auth,e.url=genDBUrl(n,e.url),ajax(e,t)},i.compact=function(e){ajax({auth:n.auth,url:genDBUrl(n,"_compact"),method:"POST"},e)},i.info=function(e){ajax({auth:n.auth,method:"GET",url:genDBUrl(n,"")},e)},i.get=function(e,t,r){typeof t=="function"&&(r=t,t={});var i=[];t.revs&&i.push("revs=true"),t.revs_info&&i.push("revs_info=true"),t.attachments&&i.push("attachments=true"),t.rev&&i.push("rev="+t.rev),t.conflicts&&i.push("conflicts="+t.conflicts),i=i.join("&"),i=i===""?"":"?"+i;var s={auth:n.auth,method:"GET",url:genDBUrl(n,e+i)},o=e.split("/");if(o.length>1&&o[0]!=="_design"&&o[0]!=="_local"||o.length>2&&o[0]==="_design"&&o[0]!=="_local")s.json=!1;ajax(s,function(e,t,n){if(e)return call(r,Pouch.Errors.MISSING_DOC);call(r,null,t,n)})},i.remove=function(e,t,r){typeof t=="function"&&(r=t,t={}),ajax({auth:n.auth,method:"DELETE",url:genDBUrl(n,e._id)+"?rev="+e._rev},r)},i.removeAttachment=function(t,r,i){ajax({auth:n.auth,method:"DELETE",url:genDBUrl(n,t)+"?rev="+r},i)},i.putAttachment=function(e,t,r,i,s){ajax({auth:n.auth,method:"PUT",url:genDBUrl(n,e)+"?rev="+t,headers:{"Content-Type":i},body:r},s)},i.put=function(e,t,r){typeof t=="function"&&(r=t,t={});if(!e||!("_id"in e))return call(r,Pouch.Errors.MISSING_ID);var i=[];t&&typeof t.new_edits!="undefined"&&i.push("new_edits="+t.new_edits),i=i.join("&"),i!==""&&(i="?"+i),ajax({auth:n.auth,method:"PUT",url:genDBUrl(n,e._id)+i,body:e},r)},i.post=function(e,t,n){typeof t=="function"&&(n=t,t={}),"_id"in e?i.put(e,t,n):s.list.length>0?(e._id=s.list.pop(),i.put(e,t,n)):s.get(function(r,o){if(r)return call(n,Pouch.Errors.UNKNOWN_ERROR);e._id=s.list.pop(),i.put(e,t,n)})},i.bulkDocs=function(e,t,r){typeof t=="function"&&(r=t,t={}),t||(t={}),typeof t.new_edits!="undefined"&&(e.new_edits=t.new_edits),ajax({auth:n.auth,method:"POST",url:genDBUrl(n,"_bulk_docs"),body:e},r)},i.allDocs=function(e,t){typeof e=="function"&&(t=e,e={});var r=[],i=undefined,s="GET";e.conflicts&&r.push("conflicts=true"),e.include_docs&&r.push("include_docs=true"),e.startkey&&r.push("startkey="+encodeURIComponent(JSON.stringify(e.startkey))),e.endkey&&r.push("endkey="+encodeURIComponent(JSON.stringify(e.endkey))),r=r.join("&"),r!==""&&(r="?"+r),typeof e.keys!="undefined"&&(s="POST",i=JSON.stringify({keys:e.keys})),ajax({auth:n.auth,method:s,url:genDBUrl(n,"_all_docs"+r),body:i},t)},i.changes=function(e){Pouch.DEBUG&&console.log(r+": Start Changes Feed: continuous="+e.continuous);var t=[],i;e.style&&t.push("style="+e.style),(e.include_docs||e.filter&&typeof e.filter=="function")&&t.push("include_docs=true"),e.continuous&&t.push("feed=longpoll"),e.conflicts&&t.push("conflicts=true"),e.descending&&t.push("descending=true"),e.filter&&typeof e.filter=="string"&&t.push("filter="+e.filter);if(e.query_params&&typeof e.query_params=="object")for(var s in e.query_params)e.query_params.hasOwnProperty(s)&&t.push(s+"="+e.query_params[s]);i="?",t.length>0&&(i+=t.join("&"));var o,u,a=function(t,r){var s={auth:n.auth,method:"GET",url:genDBUrl(n,"_changes"+i+"&since="+t),timeout:null};u=t;if(e.aborted)return;o=ajax(s,r)},f=10,l=0,c=function(t,n){n&&n.results&&n.results.forEach(function(t){var n=e.filter&&typeof e.filter=="function";if(e.aborted||n&&!e.filter.apply(this,[t.doc]))return;call(e.onChange,t)}),n&&n.last_seq&&(u=n.last_seq);if(e.continuous){t?l+=1:l=0;var r=1<<l,i=f*r,s=e.maximumWait||3e4;i>s&&call(e.complete,t||Pouch.Errors.UNKNOWN_ERROR,null),setTimeout(function(){a(u,c)},i)}else call(e.complete,null,n)};return a(e.since||0,c),{cancel:function(){Pouch.DEBUG&&console.log(r+": Cancel Changes Feed"),e.aborted=!0,o.abort()}}},i.revsDiff=function(e,t,r){typeof t=="function"&&(r=t,t={}),ajax({auth:n.auth,method:"POST",url:genDBUrl(n,"_revs_diff"),body:e},function(e,t){call(r,null,t)})},i.replicate={},i.replicate.from=function(e,t,n){return typeof t=="function"&&(n=t,t={}),Pouch.replicate(e,i,t,n)},i.replicate.to=function(e,t,n){return typeof t=="function"&&(n=t,t={}),Pouch.replicate(i,e,t,n)},i.close=function(e){call(e,null)},i};HttpPouch.destroy=function(e,t){var n=getHost(e);ajax({auth:n.auth,method:"DELETE",url:genDBUrl(n,"")},t)},HttpPouch.valid=function(){return!0};if(typeof module!="undefined"&&module.exports){var pouchdir="../";this.Pouch=require(pouchdir+"pouch.js"),this.ajax=Pouch.utils.ajax}Pouch.adapter("http",HttpPouch),Pouch.adapter("https",HttpPouch),window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB,window.IDBTransaction=window.IDBTransaction&&window.IDBTransaction.READ_WRITE?window.IDBTransaction:window.webkitIDBTransaction&&window.webkitIDBTransaction.READ_WRITE?window.webkitIDBTransaction:{READ_WRITE:"readwrite"},window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,window.storageInfo=window.storageInfo||window.webkitStorageInfo,window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;var idbError=function(e){return function(t){call(e,{status:500,error:t.type,reason:t.target})}},IdbPouch=function(opts,callback){function sortByBulkSeq(e,t){return e._bulk_seq-t._bulk_seq}function toArray(e){return Array.prototype.slice.call(e||[],0)}function fileErrorHandler(e){console.error("File system error",e)}function deleteOrphanedFiles(e){api.allDocs({include_docs:!0},function(t,n){window.requestFileSystem(window.PERSISTENT,e,function(e){var t=e.root.createReader(),r=[],i=n.rows,s=function(){t.readEntries(function(e){if(!e.length)for(var t in r){var n=!1;for(var o in i)if(i[o].doc){var u=i[o].doc;if(u._attachments)for(var a in u._attachments)u._attachments[a].digest==r[t].name&&(n=!0);if(n)break}n||r[t].remove(function(){Pouch.DEBUG&&console.log("Removed orphaned attachment: "+r[t].name)},fileErrorHandler)}else r=r.concat(toArray(e)),s()},fileErrorHandler)};s()},fileErrorHandler)})}function writeAttachmentToFile(e,t,n){window.storageInfo.queryUsageAndQuota(window.PERSISTENT,function(r,i){var s=i;i==0?s=1048576e3:r/i>.8?deleteOrphanedFiles(i):r/i>.9&&(s=2*i),Pouch.DEBUG&&console.log("Current file quota: "+i+", current usage:"+r+", new quota will be: "+s),window.storageInfo.requestQuota(window.PERSISTENT,s,function(r){window.storageInfo.queryUsageAndQuota(window.PERSISTENT,function(r,i){window.requestFileSystem(window.PERSISTENT,i,function(r){r.root.getFile(e,{create:!0},function(e){e.createWriter(function(e){e.onwriteend=function(e){Pouch.DEBUG&&console.log("Wrote attachment")},e.onerror=function(e){console.error("File write failed: "+e.toString())};var r=new Blob([t],{type:n});e.write(r)},fileErrorHandler)},fileErrorHandler)},fileErrorHandler)},fileErrorHandler)},fileErrorHandler)},fileErrorHandler)}function readAttachmentFromFile(e,t){window.storageInfo.queryUsageAndQuota(window.PERSISTENT,function(n,r){window.requestFileSystem(window.PERSISTENT,r,function(n){n.root.getFile(e,{},function(e){e.file(function(e){var n=new FileReader;n.onloadend=function(e){data=this.result,Pouch.DEBUG&&console.log("Read attachment"),t(data)},n.readAsBinaryString(e)},fileErrorHandler)},fileErrorHandler)},fileErrorHandler)},fileErrorHandler)}var POUCH_VERSION=1,DOC_STORE="document-store",BY_SEQ_STORE="by-sequence",ATTACH_STORE="attach-store",META_STORE="meta-store",name=opts.name,req=indexedDB.open(name,POUCH_VERSION),meta={id:"meta-store",updateSeq:0},instanceId=null,storeAttachmentsInIDB=!0,api={},idb=null;return Pouch.DEBUG&&console.log(name+": Open Database"),req.onupgradeneeded=function(e){var t=e.target.result;t.createObjectStore(DOC_STORE,{keyPath:"id"}).createIndex("seq","seq",{unique:!0}),t.createObjectStore(BY_SEQ_STORE,{autoIncrement:!0}).createIndex("_rev","_rev",{unique:!0}),t.createObjectStore(ATTACH_STORE,{keyPath:"digest"}),t.createObjectStore(META_STORE,{keyPath:"id",autoIncrement:!1})},req.onsuccess=function(e){idb=e.target.result;var t=idb.transaction([META_STORE],IDBTransaction.READ_WRITE);idb.onversionchange=function(){idb.close()};if(idb.setVersion&&Number(idb.version)!==POUCH_VERSION){var n=idb.setVersion(POUCH_VERSION);n.onsuccess=function(t){function n(){r.onsuccess(e)}t.target.result.oncomplete=n,r.onupgradeneeded(e)};return}var r=t.objectStore(META_STORE).get("meta-store");r.onsuccess=function(e){var n,r;e.target.result&&(meta=e.target.result),name+"_id"in meta?instanceId=meta[name+"_id"]:(instanceId=Math.uuid(),meta[name+"_id"]=instanceId,n=t.objectStore(META_STORE).put(meta)),call(callback,null,api)}},req.onerror=idbError(callback),api.type=function(){return"idb"},api.id=function(){return instanceId},api.bulkDocs=function(t,n,r){function f(){if(!a.length)return;var e=a.shift(),t=m.objectStore(DOC_STORE).get(e.metadata.id);t.onsuccess=function(n){var r=n.target.result;r?h(r,e):p(e)}}function l(e){var t=[];u.sort(sortByBulkSeq),u.forEach(function(e){delete e._bulk_seq;if(e.error){t.push(e);return}var n=e.metadata,r=Pouch.merge.winningRev(n);t.push({ok:!0,id:n.id,rev:r});if(/_local/.test(n.id))return;IdbPouch.Changes.notify(name),localStorage[name]=localStorage[name]==="a"?"b":"a"}),call(r,null,t)}function c(e,t){function l(e){n||(e?(n=e,call(t,n)):r==s.length&&c())}function c(){var n=m.objectStore(BY_SEQ_STORE).put(e.data);n.onsuccess=function(n){Pouch.DEBUG&&console.log(name+": Wrote Document ",e.metadata.id),e.metadata.seq=n.target.result,delete e.metadata.rev;var r=m.objectStore(DOC_STORE).put(e.metadata);r.onsuccess=function(){u.push(e),call(t)}}}var n=null,r=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,meta.updateSeq++;var i=m.objectStore(META_STORE).put(meta);isDeleted(e.metadata,e.metadata.rev)&&(e.data._deleted=!0);var s=e.data._attachments?Object.keys(e.data._attachments):[];for(var o in e.data._attachments)if(!e.data._attachments[o].stub){var a=e.data._attachments[o].data,f="md5-"+Crypto.MD5(a);delete e.data._attachments[o].data,e.data._attachments[o].digest=f,v(e,f,a,function(e){r++,l(e)})}else r++,l();s.length||c()}function h(e,t){var n=Pouch.merge(e.rev_tree,t.metadata.rev_tree[0],1e3),r=isDeleted(e)&&isDeleted(t.metadata)||!isDeleted(e)&&i&&n.conflicts!=="new_leaf";if(r)return u.push(d(Pouch.Errors.REV_CONFLICT,t._bulk_seq)),f();t.metadata.rev_tree=n.tree,c(t,f)}function p(e){if("was_delete"in n&&isDeleted(e.metadata))return u.push(Pouch.Errors.MISSING_DOC),f();c(e,f)}function d(e,t){return e._bulk_seq=t,e}function v(e,t,n,r){if(storeAttachmentsInIDB){var i=m.objectStore(ATTACH_STORE),s=i.get(t).onsuccess=function(s){var o=[e.metadata.id,e.metadata.rev].join("@"),u={digest:t,body:n};s.target.result?s.target.result.refs&&(u.refs=s.target.result.refs,u.refs[o]=!0):(u.refs={},u.refs[o]=!0);var a=i.put(u).onsuccess=function(e){call(r)};a.onerror=a.ontimeout=idbError(r)};s.onerror=s.ontimeout=idbError(r)}else writeAttachmentToFile(t,n),call(r)}typeof n=="function"&&(r=n,n={}),n||(n={});if(!t.docs)return call(r,Pouch.Errors.MISSING_BULK_DOCS);var i="new_edits"in n?n.new_edits:!0,s=extend(!0,[],t.docs),o=s.map(function(e,t){var n=parseDoc(e,i);return n._bulk_seq=t,e._deleted&&(n.metadata.deletions||(n.metadata.deletions={}),n.metadata.deletions[e._rev.split("-")[1]]=!0),n}),u=[],a=[];o.forEach(function(e){if(e.error)return u.push(e);if(!a.length||e.metadata.id!==a[0].metadata.id)return a.unshift(e);u.push(d(Pouch.Errors.REV_CONFLICT,e._bulk_seq))});var m=idb.transaction([DOC_STORE,BY_SEQ_STORE,ATTACH_STORE,META_STORE],IDBTransaction.READ_WRITE);m.onerror=idbError(r),m.ontimeout=idbError(r),m.oncomplete=l,f()},api.get=function(t,n,r){typeof n=="function"&&(r=n,n={}),t=parseDocId(t);if(t.attachmentId!=="")return api.getAttachment(t,{decode:!0},r);var i,s=idb.transaction([DOC_STORE,BY_SEQ_STORE,ATTACH_STORE],"readonly");s.oncomplete=function(){"error"in i?call(r,i):call(r,null,i)},s.objectStore(DOC_STORE).get(t.docId).onsuccess=function(e){var t=e.target.result;if(!e.target.result||isDeleted(t,n.rev)&&!n.rev){i=Pouch.Errors.MISSING_DOC;return}var r=Pouch.merge.winningRev(t),o=n.rev?n.rev:r,u=s.objectStore(BY_SEQ_STORE).index("_rev");u.get(o).onsuccess=function(e){var r=e.target.result;if(n.revs){var o=arrayFirst(rootToLeaf(t.rev_tree),function(e){return e.ids.indexOf(r._rev.split("-")[1])!==-1});o.ids.reverse(),r._revisions={start:o.pos+o.ids.length-1,ids:o.ids}}n.revs_info&&(r._revs_info=t.rev_tree.reduce(function(e,t){return e.concat(collectRevs(t))},[]));if(n.conflicts){var u=collectConflicts(t.rev_tree);u.length&&(r._conflicts=u)}if(n.attachments&&r._attachments){var a=Object.keys(r._attachments),f=0;a.forEach(function(e){api.getAttachment(r._id+"/"+e,{txn:s},function(t,n){r._attachments[e].data=n,++f===a.length&&(i=r)})})}else{if(r._attachments)for(var l in r._attachments)r._attachments[l].stub=!0;i=r}}}},api.getAttachment=function(e,t,n){t instanceof Function&&(n=t,t={}),typeof e=="string"&&(e=parseDocId(e));var r,i;"txn"in t?i=t.txn:(i=idb.transaction([DOC_STORE,BY_SEQ_STORE,ATTACH_STORE],"readonly"),i.oncomplete=function(){call(n,null,r)}),i.objectStore(DOC_STORE).get(e.docId).onsuccess=function(s){var o=s.target.result,u=i.objectStore(BY_SEQ_STORE);u.get(o.seq).onsuccess=function(s){function f(e){return t.decode&&(e=atob(e)),e}var o=s.target.result._attachments[e.attachmentId],u=o.digest,a=o.content_type;storeAttachmentsInIDB?i.objectStore(ATTACH_STORE).get(u).onsuccess=function(e){var i=e.target.result.body;r=f(i),"txn"in t&&call(n,null,r)}:readAttachmentFromFile(u,function(e){r=f(e),"txn"in t&&call(n,null,r)})}};return},api.put=function(e,t,n){return typeof t=="function"&&(n=t,t={}),!!e&&"_id"in e?api.bulkDocs({docs:[e]},t,yankError(n)):call(n,Pouch.Errors.MISSING_ID)},api.post=function(t,n,r){return typeof n=="function"&&(r=n,n={}),api.bulkDocs({docs:[t]},n,yankError(r))},api.putAttachment=function(t,n,r,i,s){t=parseDocId(t),api.get(t.docId,{attachments:!0},function(e,n){n._attachments||(n._attachments={}),n._attachments[t.attachmentId]={content_type:i,data:btoa(r)},api.put(n,s)})},api.remove=function(t,n,r){typeof n=="function"&&(r=n,n={}),n.was_delete=!0;var i=extend(!0,{},t);return i._deleted=!0,api.bulkDocs({docs:[i]},n,yankError(r))},api.removeAttachment=function(t,n,r){t=parseDocId(t),api.get(t.docId,function(e,i){if(e){call(r,e);return}if(i._rev!=n){call(r,Pouch.Errors.REV_CONFLICT);return}i._attachments||(i._attachments={}),delete i._attachments[t.attachmentId],api.put(i,r)})},api.allDocs=function(t,n){typeof t=="function"&&(n=t,t={});var r="startkey"in t?t.startkey:!1,i="endkey"in t?t.endkey:!1,s="descending"in t?t.descending:!1;s=s?"prev":null;var o=r&&i?IDBKeyRange.bound(r,i,!1,!1):r?IDBKeyRange.lowerBound(r,!0):i?IDBKeyRange.upperBound(i):null,u,a=idb.transaction([DOC_STORE,BY_SEQ_STORE],"readonly");a.oncomplete=function(){n(null,u)};var f=a.objectStore(DOC_STORE),l=s?f.openCursor(o,s):f.openCursor(o),c=[];l.onsuccess=function(e){function r(e,r){if(/_local/.test(e.id))return n["continue"]();if(!isDeleted(e)){var i={id:e.id,key:e.id,value:{rev:Pouch.merge.winningRev(e)}};t.include_docs&&(i.doc=r,i.doc._rev=Pouch.merge.winningRev(e),t.conflicts&&(i.doc._conflicts=collectConflicts(e.rev_tree))),c.push(i)}n["continue"]()}if(!e.target.result){u={total_rows:c.length,rows:c};return}var n=e.target.result;if(!t.include_docs)r(n.value);else{var i=a.objectStore(BY_SEQ_STORE);i.get(n.value.seq).onsuccess=function(e){r(n.value,e.target.result)}}}},api.info=function(t){var n=0,r,i=idb.transaction([DOC_STORE],"readonly");i.oncomplete=function(){t(null,r)},i.objectStore(DOC_STORE).openCursor().onsuccess=function(e){var t=e.target.result;if(!t){r={db_name:name,doc_count:n,update_seq:meta.updateSeq};return}t.value.deleted!==!0&&n++,t["continue"]()}},api.revsDiff=function(t,n,r){function u(e,n,u){t[u].map(function(e){var t=function(t){return t.rev!==e};if(!n||n._revs_info.every(t))o[u]||(o[u]={missing:[]}),o[u].missing.push(e)});if(++s===i.length)return call(r,null,o)}typeof n=="function"&&(r=n,n={});var i=Object.keys(t),s=0,o={};i.map(function(e){api.get(e,{revs_info:!0},function(t,n){u(t,n,e)})})},api.changes=function idb_changes(opts){function fetchChanges(){txn=idb.transaction([DOC_STORE,BY_SEQ_STORE]),txn.oncomplete=onTxnComplete;var e=descending?txn.objectStore(BY_SEQ_STORE).openCursor(IDBKeyRange.lowerBound(opts.since,!0),descending):txn.objectStore(BY_SEQ_STORE).openCursor(IDBKeyRange.lowerBound(opts.since,!0));e.onsuccess=onsuccess,e.onerror=onerror}function onsuccess(e){if(!e.target.result){opts.continuous&&!opts.cancelled&&IdbPouch.Changes.addListener(name,id,api,opts);for(var t=0,n=results.length;t<n;t++){var r=results[t];r&&dedupResults.push(r)}return!1}var i=e.target.result,s=i.value._id,o=resultIndices[s];if(o!==undefined)return results[o].seq=i.key,results.push(results[o]),results[o]=null,resultIndices[s]=results.length-1,i["continue"]();var u=txn.objectStore(DOC_STORE);u.get(i.value._id).onsuccess=function(e){var t=e.target.result;if(/_local/.test(t.id))return i["continue"]();var n=Pouch.merge.winningRev(t),r=txn.objectStore(BY_SEQ_STORE).index("_rev");r.get(n).onsuccess=function(e){var r=e.target.result,s=[{rev:n}];opts.style==="all_docs"&&(s=collectLeaves(t.rev_tree));var o={id:t.id,seq:i.key,changes:s,doc:r};isDeleted(t,n)&&(o.deleted=!0),opts.conflicts&&(o.doc._conflicts=collectConflicts(t.rev_tree));var u=o.id,a=resultIndices[u];a!==undefined&&(results[a]=null),results.push(o),resultIndices[u]=results.length-1,i["continue"]()}}}function onTxnComplete(){dedupResults.map(function(e){if(opts.filter&&!opts.filter.apply(this,[e.doc]))return;opts.include_docs||delete e.doc,e.seq>opts.since&&(opts.since=e.seq,call(opts.onChange,e))}),(!opts.continuous||opts.continuous&&!opts.cancelled)&&call(opts.complete,null,{results:dedupResults})}function onerror(e){opts.continuous&&!opts.cancelled?IdbPouch.Changes.addListener(name,id,opts):call(opts.complete)}opts.since||(opts.since=0),Pouch.DEBUG&&console.log(name+": Start Changes Feed: continuous="+opts.continuous);var descending="descending"in opts?opts.descending:!1;descending=descending?"prev":null;var results=[],resultIndices={},dedupResults=[],id=name+":"+Math.uuid(),txn;if(opts.filter&&typeof opts.filter=="string"){var filterName=opts.filter.split("/");api.get("_design/"+filterName[0],function(err,ddoc){var filter=eval("(function() { return "+ddoc.filters[filterName[1]]+" })()");opts.filter=filter,fetchChanges()})}else fetchChanges();if(opts.continuous)return{cancel:function(){Pouch.DEBUG&&console.log(name+": Cancel Changes Feed"),opts.cancelled=!0,IdbPouch.Changes.removeListener(name,id)}}},api.replicate={},api.replicate.from=function(t,n,r){return typeof n=="function"&&(r=n,n={}),Pouch.replicate(t,api,n,r)},api.replicate.to=function(t,n,r){return typeof n=="function"&&(r=n,n={}),Pouch.replicate(api,t,n,r)},api.close=function(e){if(idb===null)return call(e,Pouch.Errors.NOT_OPEN);idb.close(),call(e,null)},api};IdbPouch.valid=function(){return document.location.host||console.error("indexedDB cannot be used in pages served from the filesystem"),!!window.indexedDB&&!!document.location.host},IdbPouch.destroy=function(t,n){Pouch.DEBUG&&console.log(t+": Delete Database"),IdbPouch.Changes.clearListeners(t);var r=indexedDB.deleteDatabase(t);r.onsuccess=function(){call(n,null)},r.onerror=idbError(n)},IdbPouch.Changes=Changes(),Pouch.adapter("idb",IdbPouch);var POUCH_VERSION=1,POUCH_SIZE=5242880,DOC_STORE=quote("document-store"),BY_SEQ_STORE=quote("by-sequence"),ATTACH_STORE=quote("attach-store"),META_STORE=quote("metadata-store"),unknownError=function(e){return function(t){call(e,{status:500,error:t.type,reason:t.target})}},webSqlPouch=function(opts,callback){function dbCreated(){callback(null,api)}var api={},update_seq=0,name=opts.name,db=openDatabase(name,POUCH_VERSION,name,POUCH_SIZE);if(!db)return call(callback,Pouch.Errors.UNKNOWN_ERROR);db.transaction(function(e){var t="CREATE TABLE IF NOT EXISTS "+META_STORE+" (update_seq)",n="CREATE TABLE IF NOT EXISTS "+ATTACH_STORE+" (digest, json)",r="CREATE TABLE IF NOT EXISTS "+DOC_STORE+" (id unique, seq, json, winningseq)",i="CREATE TABLE IF NOT EXISTS "+BY_SEQ_STORE+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, rev UNIQUE, json)";e.executeSql(n),e.executeSql(r),e.executeSql(i),e.executeSql(t);var s="SELECT update_seq FROM "+META_STORE;e.executeSql(s,[],function(e,t){if(!t.rows.length){var n="INSERT INTO "+META_STORE+" (update_seq) VALUES (?)";e.executeSql(n,[0]);return}update_seq=t.rows.item(0).update_seq})},unknownError(callback),dbCreated),api.type=function(){return"websql"},api.id=function(){var e=localJSON.get(name+"_id",null);return e===null&&(e=Math.uuid(),localJSON.set(name+"_id",e)),e},api.info=function(e){db.transaction(function(t){var n="SELECT COUNT(id) AS count FROM "+DOC_STORE;t.executeSql(n,[],function(t,n){e(null,{db_name:name,doc_count:n.rows.item(0).count,update_seq:update_seq})})})},api.bulkDocs=function(t,n,r){function c(e,t){return e._bulk_seq-t._bulk_seq}function h(e){var t=[];a.sort(c),a.forEach(function(e){delete e._bulk_seq;if(e.error){t.push(e);return}var n=e.metadata,r=Pouch.merge.winningRev(n);t.push({ok:!0,id:n.id,rev:r});if(/_local/.test(n.id))return;update_seq++;var i="UPDATE "+META_STORE+" SET update_seq=?";u.executeSql(i,[update_seq],function(){webSqlPouch.Changes.notify(name),localStorage[name]=localStorage[name]==="a"?"b":"a"})}),call(r,null,t)}function p(e,t,n){function c(e){r||(e?(r=e,call(t,r)):i==s.length&&p())}function h(r,i){var s=e.metadata.seq=i.insertId;delete e.metadata.rev;var o=Pouch.merge.winningRev(e.metadata),u=n?"UPDATE "+DOC_STORE+" SET seq=?, json=?, winningseq=(SELECT seq FROM "+BY_SEQ_STORE+" WHERE rev=?) WHERE id=?":"INSERT INTO "+DOC_STORE+" (id, seq, winningseq, json) VALUES (?, ?, ?, ?);",f=n?[s,JSON.stringify(e.metadata),o,e.metadata.id]:[e.metadata.id,s,s,JSON.stringify(e.metadata)];r.executeSql(u,f,function(n,r){a.push(e),call(t,null)})}function p(){var t=e.data,n="INSERT INTO "+BY_SEQ_STORE+" (rev, json) VALUES (?, ?);";u.executeSql(n,[t._rev,JSON.stringify(t)],h)}var r=null,i=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,isDeleted(e.metadata,e.metadata.rev)&&(e.data._deleted=!0);var s=e.data._attachments?Object.keys(e.data._attachments):[];for(var o in e.data._attachments)if(!e.data._attachments[o].stub){var f=e.data._attachments[o].data,l="md5-"+Crypto.MD5(f);delete e.data._attachments[o].data,e.data._attachments[o].digest=l,y(e,l,f,function(e){i++,c(e)})}else i++,c();s.length||p()}function d(e,t){var n=Pouch.merge(e.rev_tree,t.metadata.rev_tree[0],1e3),r=isDeleted(e)&&isDeleted(t.metadata)||!isDeleted(e)&&i&&n.conflicts!=="new_leaf";if(r)return a.push(g(Pouch.Errors.REV_CONFLICT,t._bulk_seq)),m();t.metadata.rev_tree=n.tree,p(t,m,!0)}function v(e){if("was_delete"in n&&isDeleted(e.metadata))return a.push(Pouch.Errors.MISSING_DOC),m();p(e,m,!1)}function m(){if(!f.length)return h();var e=f.shift(),t=e.metadata.id;t in l?d(l[t],e):v(e)}function g(e,t){return e._bulk_seq=t,e}function y(e,t,n,r){var i=[e.metadata.id,e.metadata.rev].join("@"),s={digest:t,body:n},o="SELECT * FROM "+ATTACH_STORE+" WHERE digest=?";u.executeSql(o,[t],function(e,n){n.rows.length?(s.refs=JSON.parse(n.rows.item(0).json).refs,o="UPDATE "+ATTACH_STORE+" SET json=? WHERE digest=?",e.executeSql(o,[JSON.stringify(s),t],function(){call(r,null)})):(s.refs={},s.refs[i]=!0,o="INSERT INTO "+ATTACH_STORE+"(digest, json) VALUES (?, ?)",e.executeSql(o,[t,JSON.stringify(s)],function(){call(r,null)}))})}function b(e,t){for(var n=0;n<t.rows.length;n++){var r=t.rows.item(n);l[r.id]=JSON.parse(r.json)}m()}typeof n=="function"&&(r=n,n={}),n||(n={});if(!t.docs)return call(r,Pouch.Errors.MISSING_BULK_DOCS);var i="new_edits"in n?n.new_edits:!0,s=extend(!0,[],t.docs),o=s.map(function(e,t){var n=parseDoc(e,i);return n._bulk_seq=t,e._deleted&&(n.metadata.deletions||(n.metadata.deletions={}),n.metadata.deletions[e._rev.split("-")[1]]=!0),n}),u,a=[],f=[],l={};o.forEach(function(e){if(e.error)return a.push(e);if(!f.length||e.metadata.id!==f[0].metadata.id)return f.unshift(e);a.push(g(Pouch.Errors.REV_CONFLICT,e._bulk_seq))}),db.transaction(function(e){u=e;var t="("+f.map(function(e){return quote(e.metadata.id)}).join(",")+")",n="SELECT * FROM "+DOC_STORE+" WHERE id IN "+t;u.executeSql(n,[],b)},unknownError(r))},api.put=function(e,t,n){return typeof t=="function"&&(n=t,t={}),!!e&&"_id"in e?api.bulkDocs({docs:[e]},t,yankError(n)):call(n,Pouch.Errors.MISSING_ID)},api.post=function(t,n,r){return typeof n=="function"&&(r=n,n={}),api.bulkDocs({docs:[t]},n,yankError(r))},api.revsDiff=function(t,n,r){function u(e,n,u){t[u].map(function(e){var t=function(t){return t.rev!==e};if(!n||n._revs_info.every(t))o[u]||(o[u]={missing:[]}),o[u].missing.push(e)});if(++s===i.length)return call(r,null,o)}typeof n=="function"&&(r=n,n={});var i=Object.keys(t),s=0,o={};i.map(function(e){api.get(e,{revs_info:!0},function(t,n){u(t,n,e)})})},api.remove=function(t,n,r){typeof n=="function"&&(r=n,n={}),n.was_delete=!0;var i=extend(!0,{},t);return i._deleted=!0,api.bulkDocs({docs:[i]},n,yankError(r))},api.get=function(e,t,n){typeof t=="function"&&(n=t,t={}),e=parseDocId(e);if(e.attachmentId!=="")return api.getAttachment(e,{decode:!0},n);var r;db.transaction(function(n){var i="SELECT * FROM "+DOC_STORE+" WHERE id=?";n.executeSql(i,[e.docId],function(e,n){if(!n.rows.length){r=Pouch.Errors.MISSING_DOC;return}var i=JSON.parse(n.rows.item(0).json);if(isDeleted(i,t.rev)&&!t.rev){r=Pouch.Errors.MISSING_DOC;return}var s=Pouch.merge.winningRev(i),o=t.rev?t.rev:s,u="SELECT * FROM "+BY_SEQ_STORE+" WHERE rev=?";e.executeSql(u,[o],function(e,n){var s=JSON.parse(n.rows.item(0).json);if(t.revs){var o=arrayFirst(rootToLeaf(i.rev_tree),function(e){return e.ids.indexOf(s._rev.split("-")[1])!==-1});o.ids.reverse(),s._revisions={start:o.pos+o.ids.length-1,ids:o.ids}}t.revs_info&&(s._revs_info=i.rev_tree.reduce(function(e,t){return e.concat(collectRevs(t))},[]));if(t.conflicts){var u=collectConflicts(i.rev_tree);u.length&&(s._conflicts=u)}if(t.attachments&&s._attachments){var a=Object.keys(s._attachments),f=0;a.forEach(function(t){api.getAttachment(s._id+"/"+t,{txn:e},function(e,n){s._attachments[t].data=n,++f===a.length&&(r=s)})})}else{if(s._attachments)for(var l in s._attachments)s._attachments[l].stub=!0;r=s}})})},unknownError(n),function(){"error"in r?call(n,r):call(n,null,r)})},api.allDocs=function(e,t){typeof e=="function"&&(t=e,e={});var n=[],r="startkey"in e?e.startkey:!1,i="endkey"in e?e.endkey:!1,s="descending"in e?e.descending:!1,o="SELECT "+DOC_STORE+".id, "+BY_SEQ_STORE+".seq, "+BY_SEQ_STORE+".json AS data, "+DOC_STORE+".json AS metadata FROM "+BY_SEQ_STORE+" JOIN "+DOC_STORE+" ON "+BY_SEQ_STORE+".seq = "+DOC_STORE+".winningseq";r&&(o+=" WHERE "+DOC_STORE+'.id >= "'+r+'"'),i&&(o+=(r?" AND ":" WHERE ")+DOC_STORE+'.id <= "'+i+'"'),o+=" ORDER BY "+DOC_STORE+".id "+(s?"DESC":"ASC"),db.transaction(function(t){t.executeSql(o,[],function(t,r){for(var i=0,s=r.rows.length;i<s;i++){var o=r.rows.item(i),u=JSON.parse(o.metadata),a=JSON.parse(o.data);if(!/_local/.test(u.id)&&!isDeleted(u)){var o={id:u.id,key:u.id,value:{rev:Pouch.merge.winningRev(u)}};e.include_docs&&(o.doc=a,o.doc._rev=Pouch.merge.winningRev(u),e.conflicts&&(o.doc._conflicts=collectConflicts(u.rev_tree))),n.push(o)}}})},unknownError(t),function(){call(t,null,{total_rows:n.length,rows:n})})},api.changes=function idb_changes(opts){function fetchChanges(){var e="SELECT "+DOC_STORE+".id, "+BY_SEQ_STORE+".seq, "+BY_SEQ_STORE+".json AS data, "+DOC_STORE+".json AS metadata FROM "+BY_SEQ_STORE+" JOIN "+DOC_STORE+" ON "+BY_SEQ_STORE+".seq = "+DOC_STORE+".winningseq WHERE "+DOC_STORE+".seq > "+opts.since+" ORDER BY "+DOC_STORE+".seq "+(descending?"DESC":"ASC");db.transaction(function(t){t.executeSql(e,[],function(e,t){for(var n=0,r=t.rows.length;n<r;n++){var i=t.rows.item(n),s=JSON.parse(i.metadata);if(!/_local/.test(s.id)){var o={id:s.id,seq:i.seq,changes:collectLeaves(s.rev_tree),doc:JSON.parse(i.data)};o.doc._rev=Pouch.merge.winningRev(s),isDeleted(s,o.doc._rev)&&(o.deleted=!0),opts.conflicts&&(o.doc._conflicts=collectConflicts(s.rev_tree)),results.push(o)}}for(var n=0,r=results.length;n<r;n++){var t=results[n];t&&dedupResults.push(t)}dedupResults.map(function(e){if(opts.filter&&!opts.filter.apply(this,[e.doc]))return;opts.include_docs||delete e.doc,e.seq>opts.since&&(opts.since=e.seq,call(opts.onChange,e))}),opts.continuous&&!opts.cancelled?webSqlPouch.Changes.addListener(name,id,api,opts):call(opts.complete,null,{results:dedupResults})})})}opts.since||(opts.since=0),Pouch.DEBUG&&console.log(name+": Start Changes Feed: continuous="+opts.continuous);var descending="descending"in opts?opts.descending:!1;descending=descending?"prev":null;var results=[],resultIndices={},dedupResults=[],id=name+":"+Math.uuid(),txn;if(opts.filter&&typeof opts.filter=="string"){var filterName=opts.filter.split("/");api.get("_design/"+filterName[0],function(err,ddoc){var filter=eval("(function() { return "+ddoc.filters[filterName[1]]+" })()");opts.filter=filter,fetchChanges()})}else fetchChanges();if(opts.continuous)return{cancel:function(){Pouch.DEBUG&&console.log(name+": Cancel Changes Feed"),opts.cancelled=!0,webSqlPouch.Changes.removeListener(name,id)}}},api.getAttachment=function(e,t,n){function i(e){return t.decode?atob(e):e}function s(s){var o="SELECT "+BY_SEQ_STORE+".json AS data FROM "+DOC_STORE+" JOIN "+BY_SEQ_STORE+" ON "+BY_SEQ_STORE+".seq = "+DOC_STORE+".seq WHERE "+DOC_STORE+'.id = "'+e.docId+'"';s.executeSql(o,[],function(s,o){var u=JSON.parse(o.rows.item(0).data),a=u._attachments[e.attachmentId],f=a.digest,l=a.content_type,c="SELECT * FROM "+ATTACH_STORE+" WHERE digest=?";s.executeSql(c,[f],function(e,s){var o=JSON.parse(s.rows.item(0).json).body;r=i(o),"txn"in t&&call(n,null,r)})})}t instanceof Function&&(n=t,t={}),typeof e=="string"&&(e=parseDocId(e));var r;"txn"in t?s(t.txn):db.transaction(s,unknownError(n),function(){call(n,null,r)})},api.putAttachment=function(t,n,r,i,s){t=parseDocId(t),api.get(t.docId,{attachments:!0},function(e,n){n._attachments||(n._attachments={}),n._attachments[t.attachmentId]={content_type:i,data:btoa(r)},api.put(n,s)})},api.removeAttachment=function(t,n,r){t=parseDocId(t),api.get(t.docId,function(e,i){if(e){call(r,e);return}if(i._rev!=n){call(r,Pouch.Errors.REV_CONFLICT);return}i._attachments||(i._attachments={}),delete i._attachments[t.attachmentId],api.put(i,r)})},api.replicate={},api.replicate.from=function(t,n,r){return typeof n=="function"&&(r=n,n={}),Pouch.replicate(t,api,n,r)},api.replicate.to=function(t,n,r){return typeof n=="function"&&(r=n,n={}),Pouch.replicate(api,t,n,r)}};webSqlPouch.valid=function(){return!!window.openDatabase},webSqlPouch.destroy=function(e,t){var n=openDatabase(e,POUCH_VERSION,e,POUCH_SIZE);localJSON.set(e+"_id",null),n.transaction(function(e){e.executeSql("DROP TABLE IF EXISTS "+DOC_STORE,[]),e.executeSql("DROP TABLE IF EXISTS "+BY_SEQ_STORE,[]),e.executeSql("DROP TABLE IF EXISTS "+ATTACH_STORE,[]),e.executeSql("DROP TABLE IF EXISTS "+META_STORE,[])},unknownError(t),function(){call(t,null)})},webSqlPouch.Changes=Changes(),Pouch.adapter("websql",webSqlPouch);var MapReduce=function(db){function viewQuery(fun,options){function sum(e){return e.reduce(function(e,t){return e+t},0)}if(!options.complete)return;var results=[],current=null,num_started=0,completed=!1,emit=function(e,t){var n={id:current.doc._id,key:e,value:t};if(options.startkey&&Pouch.collate(e,options.startkey)<0)return;if(options.endkey&&Pouch.collate(e,options.endkey)>0)return;if(options.key&&Pouch.collate(e,options.key)!==0)return;num_started++;if(options.include_docs){if(t&&typeof t=="object"&&t._id){db.get(t._id,function(e,t){t&&(n.doc=t),results.push(n),checkComplete()});return}n.doc=current.doc}results.push(n)};eval("fun.map = "+fun.map.toString()+";"),fun.reduce&&eval("fun.reduce = "+fun.reduce.toString()+";");var conflicts="conflicts"in options?options.conflicts:!1,checkComplete=function(){if(completed&&results.length==num_started){results.sort(function(e,t){return Pouch.collate(e.key,t.key)}),options.descending&&results.reverse();if(options.reduce===!1)return options.complete(null,{rows:results});var e=[];results.forEach(function(t){var n=e[e.length-1]||null;if(n&&Pouch.collate(n.key[0][0],t.key)===0){n.key.push([t.key,t.id]),n.value.push(t.value);return}e.push({key:[[t.key,t.id]],value:[t.value]})}),e.forEach(function(e){e.value=fun.reduce(e.key,e.value)||null,e.key=e.key[0][0]}),options.complete(null,{rows:e})}};db.changes({conflicts:conflicts,include_docs:!0,onChange:function(e){"deleted"in e||(current={doc:e.doc},fun.map.call(this,e.doc))},complete:function(){completed=!0,checkComplete()}})}function httpQuery(e,t,n){var r=[],i=undefined,s="GET";typeof t.reduce!="undefined"&&r.push("reduce="+t.reduce),typeof t.include_docs!="undefined"&&r.push("include_docs="+t.include_docs),typeof t.limit!="undefined"&&r.push("limit="+t.limit),typeof t.descending!="undefined"&&r.push("descending="+t.descending),typeof t.startkey!="undefined"&&r.push("startkey="+encodeURIComponent(JSON.stringify(t.startkey))),typeof t.endkey!="undefined"&&r.push("endkey="+encodeURIComponent(JSON.stringify(t.endkey))),typeof t.key!="undefined"&&r.push("key="+encodeURIComponent(JSON.stringify(t.key))),typeof t.keys!="undefined"&&(s="POST",i=JSON.stringify({keys:t.keys})),r=r.join("&"),r=r===""?"":"?"+r;if(typeof e=="string"){var o=e.split("/");db.request({method:s,url:"_design/"+o[0]+"/_view/"+o[1]+r,body:i},n);return}var u=JSON.parse(JSON.stringify(e,function(e,t){return typeof t=="function"?t+"":t}));db.request({method:"POST",url:"_temp_view"+r,body:u},n)}function query(e,t,n){typeof t=="function"&&(n=t,t={}),n&&(t.complete=n);if(db.type()==="http")return httpQuery(e,t,n);if(typeof e=="object")return viewQuery(e,t);var r=e.split("/");db.get("_design/"+r[0],function(e,i){if(e){n&&n(e);return}viewQuery({map:i.views[r[1]].map,reduce:i.views[r[1]].reduce},t)})}return{query:query}};return MapReduce._delete=function(){},Pouch.plugin("mapreduce",MapReduce),Pouch}),define("pouchdb",["pouchdb/dist/pouchdb.amd-nightly"],function(e){return e}),define("pouchdb/dist/pouchdb.amd-nightly",function(){}),function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd?define("garden-views/garden-views",[],t):e.garden_views=t()}(this,function(){var e={};return e.by_active_install={map:function(e){if(!e.type||e.type!=="install")return;if(e.removed)return;emit(e.dashboard_title,null)}},e.dashboard_assets={map:function(e){var t;e._id=="settings"&&emit([0],e);if(!e.type)return;if(e.type==="install"){if(e.removed)return;t=Number.MAX_VALUE,e.order&&(t=Number(e.order)),emit([1,t,e.dashboard_title,"install"],{db:e.installed.db})}if(e.type==="link"){if(e.removed)return;t=Number.MAX_VALUE,e.order&&(t=Number(e.order)),emit([1,t,e.dashboard_title,"link"],{url:e.url})}e.type==="theme"&&e.selectedTheme&&emit([2],null),e.type==="script"&&emit([3],e._rev)}},e.cache_manifest={map:function(e){var t;e._id=="settings"&&emit([0],e);if(!e.type)return;if(e.type==="install"){if(e.removed)return;t=Number.MAX_VALUE,e.order&&(t=Number(e.order)),emit([1,t],e._rev)}if(e.type==="link"){if(e.removed)return;t=Number.MAX_VALUE,e.order&&(t=Number(e.order)),emit([1,t],e._rev)}e.type==="theme"&&e.selectedTheme&&emit([2],e._rev),e.type==="script"&&emit([3],e._rev)}},e.app_version_by_market={map:function(e){if(!e.type||e.type!=="install")return;if(e.removed)return;var t="details/"+e.doc_id,n=e.src.substring(0,e.src.indexOf(t)),r=e.couchapp||e.kanso;emit(n,{dashboard_title:e.dashboard_title,app:e.doc_id,version:r.config.version})}},e.get_markets={map:function(e){e.type&&e.type==="market"&&emit(e.name,e.url)}},e.get_roles={map:function(e){e.type&&e.type==="role"&&emit(e.name,e.url)}},e.get_syncs={map:function(e){e.type&&e.type==="sync"&&emit(e.name,null)}},e}),define("garden-views",["garden-views/garden-views"],function(e){return e}),function(e,t){typeof exports=="object"?module.exports=t(require("async"),require("pouchdb"),require("garden-views"),require("url"),require("stately.js")):typeof define=="function"&&define.amd?define("garden-dashboard-core/garden-dashboard-core",["async","pouchdb","garden-views","url"],t):e.garden_dashboard_core=t(e.async,e.Pouch,e.garden_views,e.url,e.Stately)}(this,function(e,t,n,r,i){var s=function(r,o){var u=this;u.dashboard_db_url=r,u.options=o,u.pouchName=s.getPouchName(r),u.determine_state_cached_session=null;var a=function(){u.states=i({INIT:{start:f},FIRST_VISIT:{sync:y,topbar:N,allAssets:L,settings:O},OFFLINE_NO_HOPE:{},READY_LOCAL_DB_UNSUPPORTED:{topbar:N,allAssets:L,settings:O},OFFLINE_WITH_USER:{poll:g,login:w,logout:E,online:S,topbar:T,allAssets:k,settings:A},OFFLINE_WITHOUT_USER:{poll:g,login:w,logout:E,online:S,topbar:T,allAssets:k,settings:A},ONLINE_WITH_USER:{poll:g,login:w,logout:E,offline:x,topbar:T,allAssets:k,settings:A},ONLINE_WITHOUT_USER:{poll:g,login:w,logout:E,offline:x,topbar:T,allAssets:k,settings:A}})},f=function(){var t=this;e.parallel({remote_dashboard:d,pouched_dashboard:function(e){if(u.options.disablePouch)return e(null,{unsupported:!0});try{v(function(t,n){if(t)return e(null,{unsupported:!0});e(null,n)})}catch(t){e(null,{unsupported:!0})}},pouched_extra:function(e){if(u.options.disablePouch)return e(null,{unsupported:!0});try{m(function(t,n){if(t)return e(null,{unsupported:!0});e(null,n)})}catch(t){e(null,{unsupported:!0})}}},function(e,n){if(e||n.pouched_dashboard.unsupported)return t.setMachineState(t.READY_LOCAL_DB_UNSUPPORTED);if(n.remote_dashboard.available){if(!n.pouched_dashboard.synced)return t.setMachineState(t.FIRST_VISIT);p(function(e,n){return c(n)?t.setMachineState(t.ONLINE_WITH_USER):t.setMachineState(t.ONLINE_WITHOUT_USER)})}!n.remote_dashboard.available&&n.pouched_dashboard.synced&&p(function(e,n){return(e||!n)&&t.setMachineState(t.OFFLINE_WITHOUT_USER),c(n)?t.setMachineState(t.OFFLINE_WITH_USER):t.setMachineState(t.OFFLINE_WITHOUT_USER)});if(!n.remote_dashboard.available&&!n.pouched_dashboard.synced)return t.states.setMachineState(t.OFFLINE_NO_HOPE)})},l=function(e){u.remote_db.request({url:"../_session"},e)},c=function(e){return e?e.userCtx?e.userCtx.name?!0:!1:!1:!1},h=function(e,t){e||(e={userCtx:null}),p(function(n,r){var i=!0;n||!r?r=e:(r.userCtx.name===e.userCtx.name&&(i=!1),r.userCtx=e.userCtx),r._id="session",i?u.extra_db.put(r,t):t(null,r)})},p=function(e){u.extra_db.get("session",function(t,n){e(t,n)})},d=function(e){t(u.dashboard_db_url,function(t,n){u.remote_db=n;var r={db:n,available:!1,session:null};if(t)return e(null,r);l(function(t,n){if(t)return e(null,r);u.determine_state_cached_session=n,console.log(u.determine_state_cached_session),r.session=n,r.available=!0,e(null,r)})})},v=function(e){try{t(u.pouchName,function(t,n){if(t)return e(t);u.local_db=n,n.info(function(t,r){if(t)return e(t);var i={db:n,synced:!1};r.doc_count>0&&(i.synced=!0),e(null,i)})})}catch(n){return e(null,{unsupported:!0})}},m=function(e){t("dashbaord_extra",function(t,n){if(t)return e(t);u.extra_db=n,e(null,n)})},g=function(){var e=this;l(function(t,n){t?p(function(t,n){return c(n)?e.setMachineState(e.OFFLINE_WITH_USER):e.setMachineState(e.OFFLINE_WITHOUT_USER)}):h(n,function(t){return c(n)?e.setMachineState(e.ONLINE_WITH_USER):e.setMachineState(e.ONLINE_WITHOUT_USER)})})},y=function(){var e=this;b(function(t){if(t)return e.setMachineState(e.READY_LOCAL_DB_UNSUPPORTED);p(function(t,n){return(t||!n)&&e.setMachineState(e.ONLINE_WITHOUT_USER),c(n)?e.setMachineState(e.ONLINE_WITH_USER):e.setMachineState(e.ONLINE_WITHOUT_USER)})})},b=function(e){t.replicate(u.remote_db,u.local_db,{},e)},w=function(e,t,n){},E=function(e){},S=function(e){},x=function(e){},T=function(e){u.local_db.query(n.dashboard_assets,{reduce:!1,include_docs:!0},function(t,n){C(t,n,e)})},N=function(e){u.remote_db.query("dashboard/dashboard_assets",{reduce:!1,include_docs:!0},function(t,n){C(t,n,e)})},C=function(t,n,r){var i={settingsDoc:{},selectedThemeDoc:null,apps:[],scripts:[]};e.forEach(n.rows,function(e,t){e.key[0]===0&&(i.settingsDoc=e.value),e.key[0]===1&&(e.key[3]=="install"&&i.apps.push({title:e.key[2],db:e.value.db,doc:e.doc}),e.key[3]=="link"&&i.apps.push({title:e.key[2],link:e.value.url,doc:e.doc,external:!0})),e.key[0]===2&&(i.selectedThemeDoc=e.doc),e.key[0]===3&&i.scripts.push(e.doc.src),t()},function(e){r(e,i)})},k=function(e){u.local_db.allDocs(e)},L=function(e){u.remote_db.allDocs(e)},A=function(e){u.local_db.get("settings",function(t,n){if(t&&t.status===404)return e(null,{});e(t,n)})},O=function(e){u.remote_db.get("settings",function(t,n){if(t&&t.status===404)return e(null,{});e(t,n)})};a()};return s.prototype.start=function(e){var t=this,n=function(r,i,s){if(s==="INIT")return;t.states.unbind(n),e(null,s)};t.states.bind(n),t.states.start()},s.prototype.sync=function(e){this.states.sync(e)},s.prototype.topbar=function(e){this.states.topbar(e)},s.prototype.allAssets=function(e){this.states.allAssets(e)},s.prototype.settings=function(e){this.states.settings(e)},s.prototype.poll=function(){this.states.poll()},s.prototype.login=function(e,t,n){this.states.login(e,t,n)},s.prototype.logout=function(){this.states.logout()},s.prototype.go_online=function(){this.states.online()},s.prototype.go_offline=function(){this.states.offline()},s.prototype.getState=function(){return this.states.getMachineState()},s.prototype.bind=function(e){this.states.bind(e)},s.prototype.getCachedSession=function(e){var t=this;this.extra_db.get("session",function(n,r){return n&&n.status===404?e(null,t.determine_state_cached_session):e(n,r)})},s.getPouchName=function(e){var t=r.parse(e),n=t.hostname+t.port;if(t.pathname){var i=t.pathname.replace(/\//g,"_");n+=i}return n},s}),define("garden-dashboard-core",["garden-dashboard-core/garden-dashboard-core"],function(e){return e}),function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd?define("garden-default-settings/garden-default-settings",[],t):e.garden_default_settings=t()}(this,function(){return{frontpage:{use_markdown:!0,use_html:!1,show_activity_feed:!1,markdown:"## Welcome to your Garden\n\nHere are some things you might want to do:\n\n- [Configure](./settings#/frontpage) this front page.\n- [Install](./install) some apps.\n- [Sync](./settings#/sync) with another garden.\n\n\n\n"},host_options:{short_urls:!1,hostnames:"http://localhost:5984,http://0.0.0.0:5985",short_app_urls:!0,rootDashboard:!1,hosted:!1,login_type:"local"},top_nav_bar:{bg_color:"#1D1D1D",link_color:"#BFBFBF",active_link_color:"#FFFFFF",active_link_bg_color:"#000000",active_bar_color:"#bd0000",show_brand:!1,icon_name:null,brand_link:null,show_gravatar:!0,show_username:!0,notification_theme:"libnotify",admin_show_futon:!1},sessions:{type:"internal",internal:{login_type:"local",redirect_frontpage_on_anon:!1},other:{login_url:"/users/_design/users-default/_rewrite/#/login",login_url_next:"/users/_design/users-default/_rewrite/#/login/{next}",signup_url:"/users/_design/users-default/_rewrite/#/signup",profile_url:"/users/_design/users-default/_rewrite/#/profile/{username}"}}}}),define("garden-default-settings",["garden-default-settings/garden-default-settings"],function(e){return e}),function(e,t){typeof exports=="object"?module.exports=t(require("underscore"),require("garden-dashboard-core"),require("garden-default-settings"),require("url")):typeof define=="function"&&define.amd?define("garden-menu/garden-menu",["underscore","garden-dashboard-core","garden-default-settings","url"],t):e.garden_menu=t(e._,e.garden_dashboard_core,e.garden_default_settings,e.url)}(this,function(e,t,n,r){var i=function(e,r){this.dashboard_db_url=e,this.options=r,this.dashboard_core=new t(e,r),this.settings=n};return i.prototype.init=function(e){var t=this,n={core:t.dashboard_core,state:"OFFLINE_NO_HOPE",settings:null};t.dashboard_core.start(function(t,r){if(r==="OFFLINE_NO_HOPE")return e("OFFLINE_NO_HOPE",n);n.state=r,console.log(n),e(null,n)})},i.prototype.getAppLinks=function(t,r){var i=this;r||(r=t,t={}),i.dashboard_core.topbar(function(s,o){i.settings=e.defaults(o.settingsDoc,n);var u=o.settingsDoc;o.dashboard_url=i.dashboard_ui_url(),o.home_url=o.dashboard_url,o.settings_url=o.dashboard_url+"settings",o.login_url=i.login_url(o.dashboard_url),u.frontpage.use_link&&(o.home_url=u.frontpage.link_url),o.apps=e.map(o.apps,function(e){return e.db&&(e.link=i.app_url_ui(e.doc)),e.doc.remote_user&&t.username&&e.doc.remote_user!==username&&(e.remote_user_warning=!0,e.remote_user=e.doc.remote_user),e}),o.grouped_apps=e.groupBy(o.apps,function(e){return e.doc.onDropdownMenu?"more_apps":"apps"}),r(null,o)})},i.prototype.login_url=function(e){var t=e+"login";return this.settings.sessions.type=="other"&&(t=this.settings.sessions.other.login_url),t},i.prototype.dashboard_ui_url=function(){if(this.settings.host_options.rootDashboard){var t=!1;if(typeof window!="undefined"){var n=window.location.host,i=this.settings.host_options.hostnames.split(",");e.each(i,function(i){var s=r.parse(i),o=s.hostname;s.port!="80"&&(e.isString(s.port)||e.isNumber(s.port))&&(o+=":"+s.port),o==n&&(t=!0)});if(t)return"/"}}return"/dashboard/_design/dashboard/_rewrite/"},i.prototype.app_url_ui=function(t){var n=t.couchapp||t.kanso;try{if(n.config.legacy_mode)return"/"+t.installed.db+"/_design/"+t.doc_id+t.open_path}catch(i){}if(typeof window!="undefined"&&this.settings.host_options.short_urls&&this.settings.host_options.short_app_urls){var s=!1,o=window.location.host,u=this.settings.host_options.hostnames.split(",");e.each(u,function(t){var n=r.parse(t),i=n.hostname;n.port!="80"&&(e.isString(n.port)||e.isNumber(n.port))&&(i+=":"+n.port),i==o&&(s=!0)});if(s)return"/"+t.installed.db+"/"}return"/"+t.installed.db+"/_design/"+t.doc_id+t.open_path},i.prototype.app_settings_ui=function(e){return this.settings.host_options.rootDashboard?"/settings#/apps/"+e._id:"/dashboard/_design/dashboard/_rewrite/settings#/apps/"+e._id},i}),define("garden-menu",["garden-menu/garden-menu"],function(e){return e}),function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd?define("jscss/lib/index",[],t):e.jscss=t()}(this,function(){var e=0,t=function(e){var t="";for(var n=0;n<e;n++)t+="  ";return t},n={compile:function(e){var n={},r=function(e,t){var i,s,t,o;for(o in e)s=typeof (i=e[o]),s=="string"?(n[t]||(n[t]={}),n[t][o]=i):s=="object"&&(o[0]=="@"?n[o]=i:r(i,(t?t+" ":"")+o))},i=function(e,n){var r="  ",s="",n=n||0,o;for(var u in e)o=e[u],s+=t(n)+u,typeof o=="object"?s+=" {\n"+i(o,n+1)+t(n)+"}\n":s+=": "+o+";\n";return s};return r(e,""),i(n,0)},embed:function(t,n){n||(n="jscss-"+e++);var r=document.createElement("style");r.type="text/css",r.rel="stylesheet",r.id=n,r.innerHTML="\n"+t,document.head.appendChild(r)}};return n}),define("jscss",["jscss/lib/index"],function(e){return e}),function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd?define("garden-menu-widget.css.js",[],t):e.garden_menu_widget_css=t()}(this,function(){return{"#dashboard-topbar":{"font-weight":"normal","line-height":"18px",color:"#404040",height:"25px",width:"100%","background-color":"#1D1D1D",position:"relative","font-family":"ProximaNovaRgRegular, 'Helvetica Neue', helvetica, arial, sans-serif","font-size":"14px"},"#dashboard-topbar .topbar-middle":{width:"940px","margin-left":"auto","margin-right":"auto"},"#dashboard-topbar .topbar-right":{"float":"right"},"#dashboard-topbar a":{"text-decoration":"none","font-weight":"normal"},"#dashboard-topbar ul":{margin:"0",padding:"0",height:"25px",overflow:"hidden","list-style-type":"none"},"#dashboard-topbar ul>li":{display:"block","float":"left"},"#dashboard-topbar ul>li>a":{display:"block",padding:"3px 10px 2px 10px",color:"#BFBFBF","font-weight":"bold","text-transform":"capitalize"},"#dashboard-topbar ul>li>a:hover":{color:"#FFFFFF","text-decoration":"none"},"#dashboard-topbar ul>li.active>a.active":{"border-top":"2px solid #95B774 !important",color:"#FFF"},"#dashboard-topbar-offline-icon":{cursor:"pointer",display:"inline-block",padding:"0 3px","border-left":"1px solid #404040;",width:"21px",height:"21px"},"#dashboard-topbar-offline-icon svg":{position:"relative",top:"2px",left:"2px"},"#dashboard-profile":{display:"inline-block",padding:"0 10px","border-left":"1px solid #404040;",position:"relative",top:"-1px"},"#dashboard-profile img":{position:"relative",top:"2px"},"#dashboard-profile h4":{display:"inline-block",margin:"0",position:"relative",top:"-3px","font-family":'"Helvetica Neue", Helvetica, Arial, sans-serif',"font-size":"13px","font-weight":"normal","line-height":"18px",color:"#BFBFBF"},"#dashboard-topbar #dashboard-topbar-session  a.login":{display:"block",padding:"2px 10px 2px 10px",color:"white"},"#dashboard-topbar #dashboard-topbar-session  a.login:hover":{color:"#ccc","text-decoration":"none"},"#dashboard-topbar #dashboard-topbar-session.active  a.login":{color:"#ccc","text-decoration":"none"}}}),window.Modernizr=function(e,t,n){function A(e){f.cssText=e}function O(e,t){return A(p.join(e+";")+(t||""))}function M(e,t){return typeof e===t}function _(e,t){return!!~(""+e).indexOf(t)}function D(e,t){for(var r in e){var i=e[r];if(!_(i,"-")&&f[i]!==n)return t=="pfx"?i:!0}return!1}function P(e,t,r){for(var i in e){var s=t[e[i]];if(s!==n)return r===!1?e[i]:M(s,"function")?s.bind(r||t):s}return!1}function H(e,t,n){var r=e.charAt(0).toUpperCase()+e.slice(1),i=(e+" "+v.join(r+" ")+r).split(" ");return M(t,"string")||M(t,"undefined")?D(i,t):(i=(e+" "+m.join(r+" ")+r).split(" "),P(i,t,n))}function B(){i.input=function(n){for(var r=0,i=n.length;r<i;r++)w[n[r]]=n[r]in l;return w.list&&(w.list=!!t.createElement("datalist")&&!!e.HTMLDataListElement),w}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),i.inputtypes=function(e){for(var r=0,i,s,u,a=e.length;r<a;r++)l.setAttribute("type",s=e[r]),i=l.type!=="text",i&&(l.value=c,l.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(s)&&l.style.WebkitAppearance!==n?(o.appendChild(l),u=t.defaultView,i=u.getComputedStyle&&u.getComputedStyle(l,null).WebkitAppearance!=="textfield"&&l.offsetHeight!==0,o.removeChild(l)):/^(search|tel)$/.test(s)||(/^(url|email)$/.test(s)?i=l.checkValidity&&l.checkValidity()===!1:i=l.value!=c)),b[e[r]]=!!i;return b}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var r="2.6.2",i={},s=!0,o=t.documentElement,u="modernizr",a=t.createElement(u),f=a.style,l=t.createElement("input"),c=":)",h={}.toString,p=" -webkit- -moz- -o- -ms- ".split(" "),d="Webkit Moz O ms",v=d.split(" "),m=d.toLowerCase().split(" "),g={svg:"http://www.w3.org/2000/svg"},y={},b={},w={},E=[],S=E.slice,x,T=function(e,n,r,i){var s,a,f,l,c=t.createElement("div"),h=t.body,p=h||t.createElement("body");if(parseInt(r,10))while(r--)f=t.createElement("div"),f.id=i?i[r]:u+(r+1),c.appendChild(f);return s=["&#173;",'<style id="s',u,'">',e,"</style>"].join(""),c.id=u,(h?c:p).innerHTML+=s,p.appendChild(c),h||(p.style.background="",p.style.overflow="hidden",l=o.style.overflow,o.style.overflow="hidden",o.appendChild(p)),a=n(c,e),h?c.parentNode.removeChild(c):(p.parentNode.removeChild(p),o.style.overflow=l),!!a},N=function(t){var n=e.matchMedia||e.msMatchMedia;if(n)return n(t).matches;var r;return T("@media "+t+" { #"+u+" { position: absolute; } }",function(t){r=(e.getComputedStyle?getComputedStyle(t,null):t.currentStyle)["position"]=="absolute"}),r},C=function(){function r(r,i){i=i||t.createElement(e[r]||"div"),r="on"+r;var s=r in i;return s||(i.setAttribute||(i=t.createElement("div")),i.setAttribute&&i.removeAttribute&&(i.setAttribute(r,""),s=M(i[r],"function"),M(i[r],"undefined")||(i[r]=n),i.removeAttribute(r))),i=null,s}var e={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return r}(),k={}.hasOwnProperty,L;!M(k,"undefined")&&!M(k.call,"undefined")?L=function(e,t){return k.call(e,t)}:L=function(e,t){return t in e&&M(e.constructor.prototype[t],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;if(typeof n!="function")throw new TypeError;var r=S.call(arguments,1),i=function(){if(this instanceof i){var e=function(){};e.prototype=n.prototype;var s=new e,o=n.apply(s,r.concat(S.call(arguments)));return Object(o)===o?o:s}return n.apply(t,r.concat(S.call(arguments)))};return i}),y.flexbox=function(){return H("flexWrap")},y.flexboxlegacy=function(){return H("boxDirection")},y.canvas=function(){var e=t.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},y.canvastext=function(){return!!i.canvas&&!!M(t.createElement("canvas").getContext("2d").fillText,"function")},y.webgl=function(){return!!e.WebGLRenderingContext},y.touch=function(){var n;return"ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch?n=!0:T(["@media (",p.join("touch-enabled),("),u,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){n=e.offsetTop===9}),n},y.geolocation=function(){return"geolocation"in navigator},y.postmessage=function(){return!!e.postMessage},y.websqldatabase=function(){return!!e.openDatabase},y.indexedDB=function(){return!!H("indexedDB",e)},y.hashchange=function(){return C("hashchange",e)&&(t.documentMode===n||t.documentMode>7)},y.history=function(){return!!e.history&&!!history.pushState},y.draganddrop=function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e},y.websockets=function(){return"WebSocket"in e||"MozWebSocket"in e},y.rgba=function(){return A("background-color:rgba(150,255,150,.5)"),_(f.backgroundColor,"rgba")},y.hsla=function(){return A("background-color:hsla(120,40%,100%,.5)"),_(f.backgroundColor,"rgba")||_(f.backgroundColor,"hsla")},y.multiplebgs=function(){return A("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(f.background)},y.backgroundsize=function(){return H("backgroundSize")},y.borderimage=function(){return H("borderImage")},y.borderradius=function(){return H("borderRadius")},y.boxshadow=function(){return H("boxShadow")},y.textshadow=function(){return t.createElement("div").style.textShadow===""},y.opacity=function(){return O("opacity:.55"),/^0.55$/.test(f.opacity)},y.cssanimations=function(){return H("animationName")},y.csscolumns=function(){return H("columnCount")},y.cssgradients=function(){var e="background-image:",t="gradient(linear,left top,right bottom,from(#9f9),to(white));",n="linear-gradient(left top,#9f9, white);";return A((e+"-webkit- ".split(" ").join(t+e)+p.join(n+e)).slice(0,-e.length)),_(f.backgroundImage,"gradient")},y.cssreflections=function(){return H("boxReflect")},y.csstransforms=function(){return!!H("transform")},y.csstransforms3d=function(){var e=!!H("perspective");return e&&"webkitPerspective"in o.style&&T("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(t,n){e=t.offsetLeft===9&&t.offsetHeight===3}),e},y.csstransitions=function(){return H("transition")},y.fontface=function(){var e;return T('@font-face {font-family:"font";src:url("https://")}',function(n,r){var i=t.getElementById("smodernizr"),s=i.sheet||i.styleSheet,o=s?s.cssRules&&s.cssRules[0]?s.cssRules[0].cssText:s.cssText||"":"";e=/src/i.test(o)&&o.indexOf(r.split(" ")[0])===0}),e},y.generatedcontent=function(){var e;return T(["#",u,"{font:0/0 a}#",u,':after{content:"',c,'";visibility:hidden;font:3px/1 a}'].join(""),function(t){e=t.offsetHeight>=3}),e},y.video=function(){var e=t.createElement("video"),n=!1;try{if(n=!!e.canPlayType)n=new Boolean(n),n.ogg=e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),n.h264=e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),n.webm=e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}catch(r){}return n},y.audio=function(){var e=t.createElement("audio"),n=!1;try{if(n=!!e.canPlayType)n=new Boolean(n),n.ogg=e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),n.mp3=e.canPlayType("audio/mpeg;").replace(/^no$/,""),n.wav=e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),n.m4a=(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,"")}catch(r){}return n},y.localstorage=function(){try{return localStorage.setItem(u,u),localStorage.removeItem(u),!0}catch(e){return!1}},y.sessionstorage=function(){try{return sessionStorage.setItem(u,u),sessionStorage.removeItem(u),!0}catch(e){return!1}},y.webworkers=function(){return!!e.Worker},y.applicationcache=function(){return!!e.applicationCache},y.svg=function(){return!!t.createElementNS&&!!t.createElementNS(g.svg,"svg").createSVGRect},y.inlinesvg=function(){var e=t.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==g.svg},y.smil=function(){return!!t.createElementNS&&/SVGAnimate/.test(h.call(t.createElementNS(g.svg,"animate")))},y.svgclippaths=function(){return!!t.createElementNS&&/SVGClipPath/.test(h.call(t.createElementNS(g.svg,"clipPath")))};for(var j in y)L(y,j)&&(x=j.toLowerCase(),i[x]=y[j](),E.push((i[x]?"":"no-")+x));return i.input||B(),i.addTest=function(e,t){if(typeof e=="object")for(var r in e)L(e,r)&&i.addTest(r,e[r]);else{e=e.toLowerCase();if(i[e]!==n)return i;t=typeof t=="function"?t():t,typeof s!="undefined"&&s&&(o.className+=" "+(t?"":"no-")+e),i[e]=t}return i},A(""),a=l=null,function(e,t){function l(e,t){var n=e.createElement("p"),r=e.getElementsByTagName("head")[0]||e.documentElement;return n.innerHTML="x<style>"+t+"</style>",r.insertBefore(n.lastChild,r.firstChild)}function c(){var e=g.elements;return typeof e=="string"?e.split(" "):e}function h(e){var t=a[e[o]];return t||(t={},u++,e[o]=u,a[u]=t),t}function p(e,n,s){n||(n=t);if(f)return n.createElement(e);s||(s=h(n));var o;return s.cache[e]?o=s.cache[e].cloneNode():i.test(e)?o=(s.cache[e]=s.createElem(e)).cloneNode():o=s.createElem(e),o.canHaveChildren&&!r.test(e)?s.frag.appendChild(o):o}function d(e,n){e||(e=t);if(f)return e.createDocumentFragment();n=n||h(e);var r=n.frag.cloneNode(),i=0,s=c(),o=s.length;for(;i<o;i++)r.createElement(s[i]);return r}function v(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return g.shivMethods?p(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+c().join().replace(/\w+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(g,t.frag)}function m(e){e||(e=t);var n=h(e);return g.shivCSS&&!s&&!n.hasCSS&&(n.hasCSS=!!l(e,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),f||v(e,n),e}var n=e.html5||{},r=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,i=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,s,o="_html5shiv",u=0,a={},f;(function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",s="hidden"in e,f=e.childNodes.length==1||function(){t.createElement("a");var e=t.createDocumentFragment();return typeof e.cloneNode=="undefined"||typeof e.createDocumentFragment=="undefined"||typeof e.createElement=="undefined"}()}catch(n){s=!0,f=!0}})();var g={elements:n.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:n.shivCSS!==!1,supportsUnknownElements:f,shivMethods:n.shivMethods!==!1,type:"default",shivDocument:m,createElement:p,createDocumentFragment:d};e.html5=g,m(t)}(this,t),i._version=r,i._prefixes=p,i._domPrefixes=m,i._cssomPrefixes=v,i.mq=N,i.hasEvent=C,i.testProp=function(e){return D([e])},i.testAllProps=H,i.testStyles=T,i.prefixed=function(e,t,n){return t?H(e,t,n):H(e,"pfx")},o.className=o.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(s?" js "+E.join(" "):""),i}(this,this.document),define("modernizer",["modernizer/modernizr-development"],function(e){return e}),define("modernizer/modernizr-development",function(){}),function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd?define("svg/dist/svg",[],t):e.jscss=t()}(this,function(){function t(){this.constructor.call(this,SVG.create("tspan"))}this.svg=function(e){return new SVG.Doc(e)},this.SVG={ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",did:0,create:function(e){return document.createElementNS(this.ns,e)},extend:function(e,t){for(var n in t)e.prototype[n]=t[n]}},SVG.Element=function(t){if(this.node=t)this.type=t.nodeName;this.attrs={"fill-opacity":1,"stroke-opacity":1,"stroke-width":0,fill:"#000",stroke:"#000",opacity:1,x:0,y:0,cx:0,cy:0,width:0,height:0,r:0,rx:0,ry:0},this.trans={x:0,y:0,scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0}},SVG.extend(SVG.Element,{move:function(e,t){return this.attr({x:e,y:t})},center:function(e,t){var n=this.bbox();return this.move(e-n.width/2,t-n.height/2)},size:function(e,t){return this.attr({width:e,height:t})},clone:function(){var e;if(this instanceof SVG.Wrap)e=this.parent[this.child.node.nodeName](),e.attrs=this.attrs,e.child.trans=this.child.trans,e.child.attr(this.child.attrs).transform({}),e.plot&&e.plot(this.child.attrs[this.child instanceof SVG.Path?"d":"points"]);else{var t=this.node.nodeName;e=t=="rect"?this.parent[t](this.attrs.width,this.attrs.height):t=="ellipse"?this.parent[t](this.attrs.rx*2,this.attrs.ry*2):t=="image"?this.parent[t](this.src):t=="text"?this.parent[t](this.content):t=="g"?this.parent.group():this.parent[t](),e.attr(this.attrs)}return e.trans=this.trans,e.transform({})},remove:function(){return this.parent!=null?this.parent.remove(this):void 0},doc:function(){return this._parent(SVG.Doc)},nested:function(){return this._parent(SVG.Nested)},attr:function(e,t,n){if(arguments.length<2){if(typeof e!="object")return this._isStyle(e)?e=="text"?this.content:e=="leading"?this[e]:this.style[e]:this.attrs[e];for(t in e)this.attr(t,e[t])}else{this.attrs[e]=t;if(e=="x"&&this._isText())for(var r=this.lines.length-1;r>=0;r--)this.lines[r].attr(e,t);else n!=null?this.node.setAttributeNS(n,e,t):this.node.setAttribute(e,t);this._isStyle(e)&&(e=="text"?this.text(t):e=="leading"?this[e]=t:this.style[e]=t,this.text(this.content))}return this},transform:function(e){if(typeof e=="string")return this.trans[e];var t,n=[];for(t in e)e[t]!=null&&(this.trans[t]=e[t]);e=this.trans;if(e.rotation!=0){var r=this.bbox();n.push("rotate("+e.rotation+","+(e.cx!=null?e.cx:r.cx)+","+(e.cy!=null?e.cy:r.cy)+")")}return n.push("scale("+e.scaleX+","+e.scaleY+")"),e.skewX!=0&&n.push("skewX("+e.skewX+")"),e.skewY!=0&&n.push("skewY("+e.skewY+")"),n.push("translate("+e.x+","+e.y+")"),this.attr("transform",n.join(" "))},data:function(e,t,n){if(arguments.length<2)try{return JSON.parse(this.attr("data-"+e))}catch(r){return this.attr("data-"+e)}else t===null?this.node.removeAttribute("data-"+e):this.attr("data-"+e,n===!0?t:JSON.stringify(t));return this},bbox:function(){var e=this.node.getBBox();return{x:e.x+this.trans.x,y:e.y+this.trans.y,cx:e.x+this.trans.x+e.width/2,cy:e.y+this.trans.y+e.height/2,width:e.width,height:e.height}},inside:function(e,t){var n=this.bbox();return e>n.x&&t>n.y&&e<n.x+n.width&&t<n.y+n.height},show:function(){return this.node.style.display="",this},hide:function(){return this.node.style.display="none",this},visible:function(){return this.node.style.display!="none"},_parent:function(e){var t=this;while(t!=null&&!(t instanceof e))t=t.parent;return t},_isStyle:function(e){return typeof e=="string"&&this._isText()?/^font|text|leading/.test(e):!1},_isText:function(){return this instanceof SVG.Text}}),SVG.Container=function(t){this.constructor.call(this,t)},SVG.Container.prototype=new SVG.Element,SVG.extend(SVG.Container,{add:function(e,t){return this.has(e)||(t=t==null?this.children().length:t,this.children().splice(t,0,e),this.node.insertBefore(e.node,this.node.childNodes[t]||null),e.parent=this),this},put:function(e,t){return this.add(e,t),e},has:function(e){return this.children().indexOf(e)>=0},children:function(){return this._children||(this._children=[])},each:function(e){var t,n=this.children();for(t=0,length=n.length;t<length;t++)n[t]instanceof SVG.Shape&&e.apply(n[t],[t,n]);return this},remove:function(e){return this.removeAt(this.children().indexOf(e))},removeAt:function(e){if(0<=e&&e<this.children().length){var t=this.children()[e];this.children().splice(e,1),this.node.removeChild(t.node),t.parent=null}return this},defs:function(){return this._defs||(this._defs=this.put(new SVG.Defs,0))},level:function(){return this.remove(this.defs()).put(this.defs(),0)},group:function(){return this.put(new SVG.G)},rect:function(e,t){return this.put((new SVG.Rect).size(e,t))},circle:function(e){return this.ellipse(e)},ellipse:function(e,t){return this.put((new SVG.Ellipse).size(e,t))},polyline:function(e){return this.put(new SVG.Wrap(new SVG.Polyline)).plot(e)},polygon:function(e){return this.put(new SVG.Wrap(new SVG.Polygon)).plot(e)},path:function(e){return this.put(new SVG.Wrap(new SVG.Path)).plot(e)},image:function(e,t,n){return t=t!=null?t:100,this.put((new SVG.Image).load(e).size(t,n!=null?n:t))},text:function(e){return this.put((new SVG.Text).text(e))},nested:function(){return this.put(new SVG.Nested)},gradient:function(e,t){return this.defs().gradient(e,t)},pattern:function(e,t,n){return this.defs().pattern(e,t,n)},mask:function(){return this.defs().put(new SVG.Mask)},first:function(){return this.children()[0]instanceof SVG.Defs?this.children()[1]:this.children()[0]},last:function(){return this.children()[this.children().length-1]},clear:function(){this._children=[];while(this.node.hasChildNodes())this.node.removeChild(this.node.lastChild);return this}}),SVG.FX=function(t){this.target=t},SVG.extend(SVG.FX,{animate:function(e,t){e=e==null?1e3:e,t=t||"<>";var n,r,i,s=this.target,o=this,u=(new Date).getTime(),a=u+e;return this.interval=setInterval(function(){var f,l=(new Date).getTime(),c=l>a?1:(l-u)/e;if(n==null){n=[];for(var h in o.attrs)n.push(h)}if(r==null){r=[];for(var h in o.trans)r.push(h);i={}}c=t=="<>"?-Math.cos(c*Math.PI)/2+.5:t==">"?Math.sin(c*Math.PI/2):t=="<"?-Math.cos(c*Math.PI/2)+1:t=="-"?c:typeof t=="function"?t(c):c,o._move?s.move(o._at(o._move.x,c),o._at(o._move.y,c)):o._center&&s.move(o._at(o._center.x,c),o._at(o._center.y,c)),o._size&&s.size(o._at(o._size.width,c),o._at(o._size.height,c));for(f=n.length-1;f>=0;f--)s.attr(n[f],o._at(o.attrs[n[f]],c));if(r.length>0){for(f=r.length-1;f>=0;f--)i[r[f]]=o._at(o.trans[r[f]],c);s.transform(i)}l>a&&(clearInterval(o.interval),o._after?o._after.apply(s,[o]):o.stop())},e>10?10:e),this},attr:function(e,t,n){if(typeof e=="object")for(var r in e)this.attr(r,e[r]);else this.attrs[e]={from:this.target.attr(e),to:t};return this},transform:function(e){for(var t in e)this.trans[t]={from:this.target.trans[t],to:e[t]};return this},move:function(e,t){var n=this.target.bbox();return this._move={x:{from:n.x,to:e},y:{from:n.y,to:t}},this},size:function(e,t){var n=this.target.bbox();return this._size={width:{from:n.width,to:e},height:{from:n.height,to:t}},this},center:function(e,t){var n=this.target.bbox();return this._move={x:{from:n.cx,to:e},y:{from:n.cy,to:t}},this},after:function(e){return this._after=e,this},stop:function(){return clearInterval(this.interval),this.attrs={},this.trans={},this._move=null,this._size=null,this._after=null,this},_at:function(e,t){return typeof e.from=="number"?e.from+(e.to-e.from)*t:e.to.r||/^#/.test(e.to)?this._color(e,t):t<1?e.from:e.to},_color:function(e,t){var n,r;return n=this._h2r(e.from||"#000"),r=this._h2r(e.to),this._r2h({r:~~(n.r+(r.r-n.r)*t),g:~~(n.g+(r.g-n.g)*t),b:~~(n.b+(r.b-n.b)*t)})},_h2r:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(this._fh(e));return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:0,g:0,b:0}},_r2h:function(e){return"#"+this._c2h(e.r)+this._c2h(e.g)+this._c2h(e.b)},_c2h:function(e){var t=e.toString(16);return t.length==1?"0"+t:t},_fh:function(e){return e.length==4?["#",e.substring(1,2),e.substring(1,2),e.substring(2,3),e.substring(2,3),e.substring(3,4),e.substring(3,4)].join(""):e}}),SVG.extend(SVG.Element,{animate:function(e,t){return(this.fx||(this.fx=new SVG.FX(this))).stop().animate(e,t)},stop:function(){return this.fx.stop(),this}}),["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","mouseenter","mouseleave","touchstart","touchend","touchmove","touchcancel"].forEach(function(e){SVG.Element.prototype[e]=function(t){var n=this;return this.node["on"+e]=typeof t=="function"?function(){return t.apply(n,arguments)}:null,this}}),SVG.on=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},SVG.off=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)},SVG.extend(SVG.Element,{on:function(e,t){return SVG.on(this.node,e,t),this},off:function(e,t){return SVG.off(this.node,e,t),this}}),SVG.G=function(){this.constructor.call(this,SVG.create("g"))},SVG.G.prototype=new SVG.Container,SVG.extend(SVG.G,{defs:function(){return this.doc().defs()}}),SVG.extend(SVG.Element,{siblings:function(){return this.parent.children()},position:function(){return this.siblings().indexOf(this)},next:function(){return this.siblings()[this.position()+1]},previous:function(){return this.siblings()[this.position()-1]},forward:function(){return this.parent.remove(this).put(this,this.position()+1)},backward:function(){var e;return this.parent.level(),e=this.position(),e>1&&this.parent.remove(this).add(this,e-1),this},front:function(){return this.parent.remove(this).put(this)},back:function(){return this.parent.level(),this.position()>1&&this.parent.remove(this).add(this,0),this}}),SVG.Defs=function(){this.constructor.call(this,SVG.create("defs"))},SVG.Defs.prototype=new SVG.Container,SVG.Mask=function(){this.constructor.call(this,SVG.create("mask")),this.attr("id",this.id="svgjs_element_"+SVG.did++)},SVG.Mask.prototype=new SVG.Container,SVG.extend(SVG.Element,{maskWith:function(e){return this.mask=e instanceof SVG.Mask?e:this.parent.mask().add(e),this.attr("mask","url(#"+this.mask.id+")")}}),SVG.Pattern=function(t){this.constructor.call(this,SVG.create("pattern")),this.attr("id",this.id="svgjs_element_"+SVG.did++)},SVG.Pattern.prototype=new SVG.Container,SVG.extend(SVG.Pattern,{fill:function(){return"url(#"+this.id+")"}}),SVG.extend(SVG.Defs,{pattern:function(e,t,n){var r=this.put(new SVG.Pattern);return n(r),r.attr({x:0,y:0,width:e,height:t,patternUnits:"userSpaceOnUse"})}}),SVG.Gradient=function(t){this.constructor.call(this,SVG.create(t+"Gradient")),this.attr("id",this.id="svgjs_element_"+SVG.did++),this.type=t},SVG.Gradient.prototype=new SVG.Container,SVG.extend(SVG.Gradient,{from:function(e,t){return this.type=="radial"?this.attr({fx:e+"%",fy:t+"%"}):this.attr({x1:e+"%",y1:t+"%"})},to:function(e,t){return this.type=="radial"?this.attr({cx:e+"%",cy:t+"%"}):this.attr({x2:e+"%",y2:t+"%"})},radius:function(e){return this.type=="radial"?this.attr({r:e+"%"}):this},at:function(e){return this.put(new SVG.Stop(e))},update:function(e){while(this.node.hasChildNodes())this.node.removeChild(this.node.lastChild);return e(this),this},fill:function(){return"url(#"+this.id+")"}}),SVG.extend(SVG.Defs,{gradient:function(e,t){var n=this.put(new SVG.Gradient(e));return t(n),n}}),SVG.Stop=function(t){this.constructor.call(this,SVG.create("stop")),this.update(t)},SVG.Stop.prototype=new SVG.Element,SVG.extend(SVG.Stop,{update:function(e){var t,n="",r=["opacity","color"];for(t=r.length-1;t>=0;t--)e[r[t]]!=null&&(n+="stop-"+r[t]+":"+e[r[t]]+";");return this.attr({offset:(e.offset!=null?e.offset:this.attrs.offset||0)+"%",style:n})}}),SVG.Doc=function(t){this.constructor.call(this,SVG.create("svg")),this.parent=typeof t=="string"?document.getElementById(t):t,this.attr({xmlns:SVG.ns,version:"1.1",width:"100%",height:"100%"}).attr("xlink",SVG.xlink,SVG.ns).defs(),this.stage()},SVG.Doc.prototype=new SVG.Container,SVG.Doc.prototype.stage=function(){var e,t=this,n=document.createElement("div");return n.style.cssText="position:relative;height:100%;",t.parent.appendChild(n),n.appendChild(t.node),e=function(){document.readyState==="complete"?(t.attr("style","position:absolute;"),setTimeout(function(){t.attr("style","position:relative;"),t.parent.removeChild(t.node.parentNode),t.node.parentNode.removeChild(t.node),t.parent.appendChild(t.node)},5)):setTimeout(e,10)},e(),this},SVG.Shape=function(t){this.constructor.call(this,t)},SVG.Shape.prototype=new SVG.Element,SVG.Wrap=function(t){this.constructor.call(this,SVG.create("g")),this.node.insertBefore(t.node,null),this.child=t,this.type=t.node.nodeName},SVG.Wrap.prototype=new SVG.Shape,SVG.extend(SVG.Wrap,{move:function(e,t){return this.transform({x:e,y:t})},size:function(e,t){var n=e/this._b.width;return this.child.transform({scaleX:n,scaleY:t!=null?t/this._b.height:n}),this},center:function(e,t){return this.move(e+this._b.width*this.child.trans.scaleX/-2,t+this._b.height*this.child.trans.scaleY/-2)},attr:function(e,t,n){if(typeof e=="object")for(t in e)this.attr(t,e[t]);else{if(arguments.length<2)return e=="transform"?this.attrs[e]:this.child.attrs[e];e=="transform"?(this.attrs[e]=t,n!=null?this.node.setAttributeNS(n,e,t):this.node.setAttribute(e,t)):this.child.attr(e,t,n)}return this},plot:function(e){return this.child.plot(e),this._b=this.child.bbox(),this.child.transform({x:-this._b.x,y:-this._b.y}),this}}),SVG.Rect=function(){this.constructor.call(this,SVG.create("rect"))},SVG.Rect.prototype=new SVG.Shape,SVG.Ellipse=function(){this.constructor.call(this,SVG.create("ellipse"))},SVG.Ellipse.prototype=new SVG.Shape,SVG.extend(SVG.Ellipse,{move:function(e,t){return this.attrs.x=e,this.attrs.y=t,this.center()},size:function(e,t){return this.attr({rx:e/2,ry:(t!=null?t:e)/2}).center()},center:function(e,t){return this.attr({cx:e||(this.attrs.x||0)+(this.attrs.rx||0),cy:t||(this.attrs.y||0)+(this.attrs.ry||0)})}}),SVG.Line=function(){this.constructor.call(this,SVG.create("line"))},SVG.Line.prototype=new SVG.Shape,SVG.extend(SVG.Line,{move:function(e,t){var n=this.bbox();return this.attr({x1:this.attr("x1")-n.x+e,y1:this.attr("y1")-n.y+t,x2:this.attr("x2")-n.x+e,y2:this.attr("y2")-n.y+t})},center:function(e,t){var n=this.bbox();return this.move(e-n.width/2,t-n.height/2)},size:function(e,t){var n=this.bbox();return this.attr(this.attr("x1")<this.attr("x2")?"x2":"x1",n.x+e),this.attr(this.attr("y1")<this.attr("y2")?"y2":"y1",n.y+t)}}),SVG.extend(SVG.Container,{line:function(e,t,n,r){return this.put((new SVG.Line).attr({x1:e,y1:t,x2:n,y2:r}))}}),SVG.Poly={plot:function(e){return this.attr("points",e||"0,0"),this}},SVG.Polyline=function(){this.constructor.call(this,SVG.create("polyline"))},SVG.Polyline.prototype=new SVG.Shape,SVG.extend(SVG.Polyline,SVG.Poly),SVG.Polygon=function(){this.constructor.call(this,SVG.create("polygon"))},SVG.Polygon.prototype=new SVG.Shape,SVG.extend(SVG.Polygon,SVG.Poly),SVG.Path=function(){this.constructor.call(this,SVG.create("path"))},SVG.Path.prototype=new SVG.Shape,SVG.extend(SVG.Path,{move:function(e,t){this.transform({x:e,y:t})},plot:function(e){return this.attr("d",e||"M0,0")}}),SVG.Image=function(){this.constructor.call(this,SVG.create("image"))},SVG.Image.prototype=new SVG.Shape,SVG.extend(SVG.Image,{load:function(e){return this.src=e,e?this.attr("xlink:href",e,SVG.xlink):this}});var e=["size","family","weight","stretch","variant","style"];SVG.Text=function(){this.constructor.call(this,SVG.create("text")),this.style={"font-size":16,"font-family":"Helvetica","text-anchor":"start"},this.leading=1.2},SVG.Text.prototype=new SVG.Shape,SVG.extend(SVG.Text,{text:function(e){this.content=e=e||"text",this.lines=[];var n,r,i,s=this._style(),o=this.doc(),u=e.split("\n"),a=this.style["font-size"];while(this.node.hasChildNodes())this.node.removeChild(this.node.lastChild);for(n=0,r=u.length;n<r;n++)i=(new t).text(u[n]).attr({dy:a*this.leading-(n==0?a*.3:0),x:this.attrs.x||0,style:s}),this.node.appendChild(i.node),this.lines.push(i);return this.attr("style",s)},_style:function(){var t,n="";for(t=e.length-1;t>=0;t--)this.style["font-"+e[t]]!=null&&(n+="font-"+e[t]+":"+this.style["font-"+e[t]]+";");return n+="text-anchor:"+this.style["text-anchor"]+";",n}}),t.prototype=new SVG.Shape,SVG.extend(t,{text:function(e){return this.node.appendChild(document.createTextNode(e)),this}}),SVG.Nested=function(){this.constructor.call(this,SVG.create("svg")),this.attr("overflow","visible")},SVG.Nested.prototype=new SVG.Container,SVG._stroke=["color","width","opacity","linecap","linejoin","miterlimit","dasharray","dashoffset"],SVG._fill=["color","opacity","rule"];var n=function(e,t){return t=="color"?e:e+"-"+t};return["fill","stroke"].forEach(function(e){SVG.Shape.prototype[e]=function(t){var r;if(typeof t=="string")this.attr(e,t);else for(r=SVG["_"+e].length-1;r>=0;r--)t[SVG["_"+e][r]]!=null&&this.attr(n(e,SVG["_"+e][r]),t[SVG["_"+e][r]]);return this}}),[SVG.Element,SVG.FX].forEach(function(e){e&&SVG.extend(e,{rotate:function(e){return this.transform({rotation:e||0})},skew:function(e,t){return this.transform({skewX:e||0,skewY:t||0})},scale:function(e,t){return this.transform({scaleX:e,scaleY:t==null?e:t})},opacity:function(e){return this.attr("opacity",e)}})}),SVG.G&&SVG.extend(SVG.G,{move:function(e,t){return this.transform({x:e,y:t})}}),SVG.Text&&SVG.extend(SVG.Text,{font:function(t){var n,r={};for(n in t)n=="leading"?r[n]=t[n]:n=="anchor"?r["text-anchor"]=t[n]:e.indexOf(n)>-1?r["font-"+n]=t[n]:void 0;return this.attr(r).text(this.content)}}),svg}),define("svg",["svg/dist/svg"],function(e){return e}),function(e,t){typeof exports=="object"?module.exports=t(require("svg")):typeof define=="function"&&define.amd?define("sync-status-icon/sync-status-icon",["svg"],t):e.SyncIcon=t(e.svg)}(this,function(e){var t=function(t,r){var i=this,s={size:294,disabled_color:"#ccc",mouseover_color:"#eee",online_color:"#090",sync_color:"#050",offline_color:"#900",state:"disabled"};r||(r=s),r.size||(r.size=s.size),r.disabled_color||(r.disabled_color=s.disabled_color),r.mouseover_color||(r.mouseover_color=s.mouseover_color),r.online_color||(r.online_color=s.online_color),r.offline_color||(r.offline_color=s.offline_color),r.state||(r.state=s.state),this.options=r,this.callback=!1,this.animating=!1;var o=256,u=294;i.options.height=o/u*i.options.size,this.paper=e(t).size(i.options.size,i.options.size),this.main_path=this.paper.path(n),this.main_path.size(i.options.size,i.options.height),this.main_path.attr({fill:this.options.disabled_color});var a=function(e){i.animating=!0,i.main_path.animate(1e3,"<>").rotate(0).after(function(){i.animating=!1,e&&e()})},f=function(e){i.animating=!0,i.main_path.animate(1e3,"<>").rotate(-90).after(function(){i.animating=!1,e&&e()})},l=function(){i.main_path.rotate(0),i.main_path.attr({fill:i.options.online_color}),i.options.state="online"},c=function(){i.main_path.rotate(0),i.main_path.attr({fill:i.options.offline_color}),i.options.state="offline"},h=function(){i.main_path.rotate(0);var e=i.paper.gradient("linear",function(e){e.at({offset:0,color:i.options.sync_color,opacity:1}),e.at({offset:100,color:i.options.online_color,opacity:1})}),t=0;i.sync_interval=setInterval(function(){e.update(function(e){e.at({offset:t,color:i.options.online_color,opacity:1}),e.at({offset:100,color:i.options.sync_color,opacity:1}),t+=10,t>100&&(t=0)})},100),i.main_path.attr({fill:e.fill()}),i.options.state="syncing"},p=function(){i.main_path.rotate(-90),i.main_path.attr({fill:i.options.disabled_color}),i.options.state="disabled"};this.state_change=function(e){i.sync_interval&&e!=="syncing"&&(clearInterval(i.sync_interval),i.sync_interval=null);if(i.options.state==="disabled"&&e==="online")return a(l);if(i.options.state==="disabled"&&e==="offline")return a(c);if(i.options.state==="disabled"&&e==="syncing")return a(h);if(i.options.state==="online"&&e==="disabled")return f(p);if(i.options.state==="offline"&&e==="disabled")return f(p);if(e==="online")return l();if(e==="offline")return c();if(e==="syncing")return h();if(e==="disabled")return p()},this.paper.on("mouseover",function(){if(i.animating)return}),this.paper.on("mouseout",function(){if(i.animating)return}),this.clicked=function(){i.callback&&i.callback("click")},i.paper.touchstart(function(){i.clicked()}),i.paper.click(function(){i.clicked()}),i.state_change(i.options.state)};t.prototype.disabled=function(){this.state_change("disabled")},t.prototype.offline=function(){this.state_change("offline")},t.prototype.online=function(){this.state_change("online")},t.prototype.syncing=function(){this.state_change("syncing")},t.prototype.click=function(e){this.callback=e},t.prototype.getState=function(){return this.options.state};var n="M294.1,79.0H246.3C226.7,31.9,180.0,0,128.1,0C57.5,0,0,57.4,0,128.1C0,198.8,57.5,256.3,128.1,256.3c51.9,0,98.5-31.8,118.2-79.0h47.7V79.0zM256.1,139.2H128.1c-6.1,0-11.1-4.9-11.1-11.1c0-6.1,4.9-11.1,11.1-11.1h127.9V139.2zM128.1,218.3c-49.7,0-90.1-40.4-90.1-90.1c0-49.7,40.4-90.1,90.1-90.1c30.8,0,59.1,16.0,75.5,41.0h-75.5c-27.0,0-49.1,22.0-49.1,49.1c0,27.0,22.0,49.1,49.1,49.1h75.5C187.3,202.3,159.0,218.3,128.1,218.3z",r="M-7.2727275,54.781471C-7.2727275,54.781471,-8.8503233,54.781471,-8.8503233,54.781471C-8.8503233,54.781471,-8.8503233,52.267212,-8.8503233,52.267212C-8.8503233,52.267212,-7.272727499999999,52.267212,-7.272727499999999,52.267212C-7.272727499999999,52.267212,-7.2727275,54.781471,-7.2727275,54.781471 M-9.6861906,54.780155C-9.6861906,54.780155,-11.263786,54.780155,-11.263786,54.780155C-11.263786,54.780155,-11.263786,52.265896,-11.263786,52.265896C-11.263786,52.265896,-9.6861906,52.265896,-9.6861906,52.265896C-9.6861906,52.265896,-9.6861906,54.780155,-9.6861906,54.780155 M-12.035547,54.779095C-12.035547,54.779095,-13.613142999999999,54.779095,-13.613142999999999,54.779095C-13.613142999999999,54.779095,-13.613142999999999,52.264835,-13.613142999999999,52.264835C-13.613142999999999,52.264835,-12.035547,52.264835,-12.035547,52.264835C-12.035547,52.264835,-12.035547,54.779095,-12.035547,54.779095";return t}),define("sync-status-icon",["sync-status-icon/sync-status-icon"],function(e){return e}),function(e,t){typeof exports=="object"?module.exports=t(require("url"),require("garden-menu")):typeof define=="function"&&define.amd?define("garden-menu-widget",["url","garden-menu","jscss","./garden-menu-widget.css.js","modernizer","sync-status-icon","svg"],t):e.garden_menu_widget=t(e.url,e.garden_menu,e.jscss,e.garden_menu_widget_css,e.Modernizr,e.svg,e.SyncIcon,e.JST["templates/topbar.underscore"],e.JST["templates/profile.underscore"])}(this,function(e,t,n,r,i,s,o,u,a){function l(e){if(e==="FIRST_VISIT")return"disabled";if(e==="OFFLINE_NO_HOPE")return"disabled";if(e==="READY_LOCAL_DB_UNSUPPORTED")return"disabled";if(e==="OFFLINE_WITH_USER")return"offline";if(e==="OFFLINE_WITHOUT_USER")return"offline";if(e==="ONLINE_WITH_USER")return"online";if(e==="ONLINE_WITHOUT_USER")return"online"}function c(){return $.ajax({url:"/dashboard/_design/dashboard/_rewrite/_couch/_session",type:"DELETE",dataType:"json",success:function(){var e=h();e?window.location.reload():window.location=$("#dashboard-topbar-session").data("login")},error:function(){alert("error loging out.")}}),!1}function h(){var e;return $.ajax({url:window.location,type:"HEAD",async:!1,success:function(t){e=!0},error:function(){e=!1}}),e}function p(e){var t=e.data("db");t&&$(e).bind("click",function(){$(this).removeClass("hover");var e;return $.ajax({url:"/dashboard/_design/dashboard/_rewrite/_couch/"+t,type:"HEAD",dataType:"json",async:!1,success:function(t){e=!0},error:function(){e=!1,humane.error("Access Denied.")}}),e})}var f=function(e){this.dashboard_db_url=e;var n={disablePouch:!0};if(i.indexeddb||i.websqldatabase)n.disablePouch=!1;bowser.firefox&&bowser.version<12&&(n.disablePouch=!0),bowser.opera&&bowser.version<12&&(n.disablePouch=!0),bowser.chrome&&bowser.version<19&&(n.disablePouch=!0),bowser.safari&&bowser.version<=5&&(n.disablePouch=!0),bowser.iphone&&bowser.version<=5&&(n.disablePouch=!0),this.garden_menu=new t(e,n)};f.prototype.init=function(e){var t=this;t.last_state=null,t.garden_menu.init(function(n,r){t.core=r.core,t.garden_menu.getAppLinks(function(n,r){if(n)return e(n);t.loadTopbar(r,function(n){t.cachedLinks=r,t.core.getCachedSession(function(e,n){console.log(e,n),t.last_user=n.userCtx.name,t.showSession(n)}),t.poll_interval=setInterval(function(){t.poll()},5e3),e(n)})})})},f.prototype.poll=function(){this.core.poll()},f.prototype.loadTopbar=function(e,t){var i=this;n.embed(n.compile(r));var s=$("#dashboard-topbar");s.length===0&&(s=$('<div id="dashboard-topbar"></div>'),$("body").prepend(s)),s.html(u(e));var a=window.location.pathname,f=s.find("a.home").attr("href");f==a&&s.find("a.home").addClass("active");var h=s.find("#dashboard-topbar-session a").attr("href");h==a&&s.find("#dashboard-topbar-session").addClass("active"),$("#dashboard-topbar ul.kanso-nav li").each(function(e){var t=$(this).find("a"),n=t.attr("href");$(this).hasClass("home")?n==a&&($(this).addClass("active"),t.addClass("active")):(a.indexOf(n)===0&&($(this).addClass("active"),t.addClass("active")),p(t))}),$("#dashboard-topbar a").each(function(){var e=$(this),t=e.attr("href");if(a.indexOf(t)===0&&e.data("remote_user_warn")){var n=e.data("remote_user");setTimeout(function(){confirm("Warning: The recommended user for this db is "+n+". Do you want to login as that user?")&&(window.location=$("#dashboard-topbar-session").data("login")+"?redirect="+encodeURIComponent(window.location)+"&user="+encodeURIComponent(n))},10)}}),$("#dashboard-topbar .more-apps").click(function(){var e=$(this),t=$("#dashboard-more-apps"),n=e.position().left;return t.css("left",n+"px").toggle(0,function(){t.is(":visible")?e.addClass("dashboard-menu-highlight"):e.removeClass("dashboard-menu-highlight")}),$(document).one("click",function(){e.removeClass("dashboard-menu-highlight"),$("#dashboard-more-apps").hide()}),!1}),$("#dashboard-topbar .username").click(function(){return $("#dashboard-profile").toggle(),$(document).one("click",function(){$("#dashboard-profile").hide()}),!1}),$("#dashboard-topbar .logout").click(c);var d=$("#dashboard-topbar .login").attr("href"),v=d+"?redirect="+encodeURIComponent(window.location),m=$("#dashboard-topbar-session").data("sessiontype");m=="other"&&(v=d+"/"+encodeURIComponent(window.location)),$("#dashboard-topbar .login").attr("href",v);try{var g=JSON.parse(decodeURI($("#dashboard-topbar-session").data("userctx"))),y=require("session");y.emit("change",g)}catch(b){}var w=a+window.location.hash;w.indexOf(d)===0&&($("#dashboard-topbar-session").addClass("active"),$("#dashboard-topbar-session").find("ul li:first").addClass("active")),$("#dashboard-topbar").data("ready",!0),$("#dashboard-topbar").trigger("ready"),i.sync_icon=new o("dashboard-topbar-offline-icon",{size:21,state:l(i.core.getState())}),i.core.bind(function(e,t,n){if(i.last_state===n)return;var r=l(n);i.sync_icon[r](),i.core.getCachedSession(function(e,t){console.log(t);if(t.userCtx.name===i.last_user)return;i.showSession(t),i.last_user=t.userCtx.name}),i.last_state=n}),i.sync_icon.click(function(){var e=i.core.getState();e==="FIRST_VISIT"&&(i.sync_icon.syncing(),i.core.sync())}),t(null)},f.prototype.showSession=function(e){console.log("show session"),e.is_user=e.userCtx.name||!1,console.log(e.no_user),e.displayName=e.userCtx.name,e.login_url=this.cachedLinks.login_url,$("#dashboard-profile").html(a(e))};var d="M30.66554752,1.06327272C15.94942252,1.4410638199999999,2.67904052,13.81563802,1.28828452,28.48040802C-0.5069144800000001,42.39397402,8.504418520000002,56.82919702,21.84619652,61.23814702C35.07606852,66.06837902,51.20899352,60.38447702,58.39769252,48.242122020000004C66.24072452,35.93774102,63.66730352,18.15905002,52.444152519999996,8.75370002C46.52340152,3.51029022,38.560980519999994,0.73151612,30.66554752,1.06327272C30.66554752,1.06327272,30.66554752,1.06327272,30.66554752,1.06327272M32.38429752,10.15702302C40.72049052,10.074793020000001,49.451892519999994,14.83554902,52.22042552,23.01319002C52.50241952,24.71563202,55.12413752,28.96646602,51.821710519999996,28.18827302C48.80090652,28.18827302,45.780101519999995,28.18827302,42.75929752,28.18827302C42.75929752,30.61535602,42.75929752,33.04244002,42.75929752,35.46952302C46.38429752,35.46952302,50.00929752,35.46952302,53.63429752,35.46952302C52.80011552,42.98521802,47.764895519999996,50.11948802,40.41155851999999,52.43999502C32.140354519999995,55.23751602,22.072753519999996,53.890492019999996,15.840880519999995,47.42335402C12.594645519999995,44.21836502,10.971735519999996,39.739303019999994,10.446797519999995,35.28202302C13.915547519999995,35.28202302,17.384297519999993,35.28202302,20.853047519999993,35.28202302C20.853047519999993,32.854940019999994,20.853047519999993,30.427856019999997,20.853047519999993,28.000773019999997C17.415547519999993,28.000773019999997,13.978047519999993,28.000773019999997,10.540547519999993,28.000773019999997C11.475895519999993,20.89611402,16.129901519999994,14.137505019999997,23.067131519999993,11.790908019999996C26.032790519999992,10.664815019999995,29.214289519999994,10.124076019999997,32.38429751999999,10.157023019999997C32.38429751999999,10.157023019999997,32.38429752,10.15702302,32.38429752,10.15702302M20.94679752,18.84452302C20.94679752,27.54244002,20.94679752,36.24035602,20.94679752,44.93827302C23.17596452,44.93827302,25.40513052,44.93827302,27.63429752,44.93827302C27.63429752,36.24035601999999,27.63429752,27.542440019999997,27.63429752,18.844523019999997C25.40513052,18.844523019999997,23.17596452,18.844523019999997,20.94679752,18.844523019999997C20.94679752,18.844523019999997,20.94679752,18.84452302,20.94679752,18.84452302M35.97804752,19.18827302C35.97804752,27.88619002,35.97804752,36.58410602,35.97804752,45.28202302C38.207214519999994,45.28202302,40.43638051999999,45.28202302,42.66554752,45.28202302C42.66554752,36.58410601999999,42.66554752,27.886190019999997,42.66554752,19.188273019999997C40.43638052,19.188273019999997,38.20721452,19.188273019999997,35.97804752,19.188273019999997C35.97804752,19.188273019999997,35.97804752,19.18827302,35.97804752,19.18827302",v="M-7.2727275,54.781471C-7.2727275,54.781471,-8.8503233,54.781471,-8.8503233,54.781471C-8.8503233,54.781471,-8.8503233,52.267212,-8.8503233,52.267212C-8.8503233,52.267212,-7.272727499999999,52.267212,-7.272727499999999,52.267212C-7.272727499999999,52.267212,-7.2727275,54.781471,-7.2727275,54.781471 M-9.6861906,54.780155C-9.6861906,54.780155,-11.263786,54.780155,-11.263786,54.780155C-11.263786,54.780155,-11.263786,52.265896,-11.263786,52.265896C-11.263786,52.265896,-9.6861906,52.265896,-9.6861906,52.265896C-9.6861906,52.265896,-9.6861906,54.780155,-9.6861906,54.780155 M-12.035547,54.779095C-12.035547,54.779095,-13.613142999999999,54.779095,-13.613142999999999,54.779095C-13.613142999999999,54.779095,-13.613142999999999,52.264835,-13.613142999999999,52.264835C-13.613142999999999,52.264835,-12.035547,52.264835,-12.035547,52.264835C-12.035547,52.264835,-12.035547,54.779095,-12.035547,54.779095";return f})